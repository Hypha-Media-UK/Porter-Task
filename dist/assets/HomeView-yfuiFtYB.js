import{a as I,r as y,b as o,e,A as E,B as F,F as b,C as A,o as i,t as C,c as m,h as j,w as q,l as _,D as $,f as G,i as J}from"./vendor-d6AZ6u8N.js";import{_ as L,u as K,a as Q}from"./index-DNYSQN-_.js";import{L as W}from"./LoadingSpinner-DATLn-f0.js";import{S as z}from"./ShiftOverview-C-6JzSaX.js";const X={class:"porter-selection-form"},Y={class:"form-section"},Z={class:"selection-control"},tt=["disabled"],et=["value"],st=["disabled"],ot={key:0,class:"empty-state"},it={key:1,class:"porter-list"},rt={class:"porter-tags"},nt={class:"porter-name"},at=["onClick"],lt=I({__name:"PorterSelectionForm",props:{availablePorters:{},assignedPorters:{}},emits:["add-porter","remove-porter"],setup(D,{emit:g}){const S=D,f=g,r=y("");function v(){r.value&&!S.assignedPorters.includes(r.value)&&(f("add-porter",r.value),r.value="")}function h(u){f("remove-porter",u)}return(u,n)=>(i(),o("div",X,[n[4]||(n[4]=e("h3",null,"Porter Assignment",-1)),n[5]||(n[5]=e("p",{class:"description"},"Select porters who will be working during this shift",-1)),e("div",Y,[e("div",Z,[E(e("select",{"onUpdate:modelValue":n[0]||(n[0]=l=>r.value=l),class:"form-control",disabled:!u.availablePorters.length},[n[1]||(n[1]=e("option",{value:"",disabled:""},"Select porter",-1)),(i(!0),o(b,null,A(u.availablePorters,l=>(i(),o("option",{key:l,value:l},C(l),9,et))),128))],8,tt),[[F,r.value]]),e("button",{class:"btn-primary",onClick:v,disabled:!r.value}," Add Porter ",8,st)]),u.assignedPorters.length===0?(i(),o("div",ot,n[2]||(n[2]=[e("p",null,"No porters assigned to this shift yet.",-1)]))):(i(),o("div",it,[n[3]||(n[3]=e("h4",null,"Assigned Porters:",-1)),e("div",rt,[(i(!0),o(b,null,A(u.assignedPorters,l=>(i(),o("div",{key:l,class:"porter-tag"},[e("span",nt,C(l),1),e("button",{class:"remove-porter",onClick:R=>h(l),title:"Remove porter"}," Ã— ",8,at)]))),128))])]))])]))}}),dt=L(lt,[["__scopeId","data-v-0d35459c"]]),ut={class:"home-view"},vt={key:0,class:"home-loading"},ct={key:0,class:"active-shift"},ft={class:"shift-actions"},ht={key:0,class:"previous-shift"},pt={key:1,class:"new-shift"},mt={class:"shift-form"},gt={class:"form-group"},St=["value"],_t={class:"shift-actions"},yt=["disabled"],bt=["disabled"],wt=I({__name:"HomeView",setup(D){const g=J("navigate"),S=(s,t)=>{g&&g(s,t)},f=K(),r=Q(),{isShiftActive:v,currentShift:h,startShift:u,endShift:n,addPorterToShift:l,removePorterFromShift:R,loadShiftData:N,isLoaded:w}=f,p=y(!0),H=m(()=>!p.value&&r.isInitialized&&w),T=m(()=>H.value&&v!==void 0),k=m(()=>r.supervisors),O=m(()=>r.porters),c=y(""),d=y([]),V=m(()=>{const s=f.archivedShifts;return!s||s.length===0?null:[...s].sort((a,P)=>{const U=new Date(a.date).getTime();return new Date(P.date).getTime()-U})[0]}),B=async s=>{try{if(!c.value)return;const t=await u(s,c.value);if(d.value&&d.value.length>0){for(const a of d.value)try{await l(a)}catch(P){console.error(`Error adding porter ${a}:`,P)}d.value=[]}S("tasks")}catch(t){console.error("Error starting shift:",t)}},x=s=>{d.value.includes(s)||d.value.push(s)},M=s=>{const t=d.value.indexOf(s);t!==-1&&d.value.splice(t,1)};return j(async()=>{try{p.value=!0,await r.initialize(),await N(),console.log("HomeView - Data initialization complete:"),console.log("- Settings initialized:",r.isInitialized),console.log("- Shift data loaded:",w),console.log("- Current shift status:",v?"Active":"None"),k.value.length>0&&(c.value=k.value[0])}catch(s){console.error("Error initializing home view:",s)}finally{setTimeout(async()=>{r.isInitialized&&!w&&(console.log("Performing additional shift data check..."),await N()),console.log("Final shift status check:",v?"Active":"None"),p.value=!1},500)}}),q(()=>({isActive:v,shift:h}),s=>{p.value||console.log("HomeView - Shift status changed:",s.isActive?"Active":"None")},{deep:!0}),(s,t)=>(i(),o("main",ut,[p.value?(i(),o("div",vt,[_(W,{message:"Loading shift data..."})])):(i(),o(b,{key:1},[T.value&&$(v)&&$(h)?(i(),o("section",ct,[t[5]||(t[5]=e("h1",null,"Current Shift",-1)),_(z,{shift:$(h),showEndButton:!1},null,8,["shift"]),e("div",ft,[e("button",{class:"btn-primary",onClick:t[0]||(t[0]=a=>S("tasks"))},"Open Shift")]),V.value?(i(),o("div",ht,[t[4]||(t[4]=e("h2",null,"Previous Shift",-1)),_(z,{shift:V.value,showEndButton:!1,variant:"previous"},null,8,["shift"])])):G("",!0)])):(i(),o("section",pt,[t[8]||(t[8]=e("h1",null,"Start New Shift",-1)),t[9]||(t[9]=e("p",null,"Create a new porter shift to start tracking and managing tasks.",-1)),e("div",mt,[e("div",gt,[t[7]||(t[7]=e("label",{for:"supervisor"},"Supervisor",-1)),E(e("select",{id:"supervisor","onUpdate:modelValue":t[1]||(t[1]=a=>c.value=a),class:"form-control"},[t[6]||(t[6]=e("option",{value:"",disabled:""},"Select Supervisor",-1)),(i(!0),o(b,null,A(k.value,a=>(i(),o("option",{key:a,value:a},C(a),9,St))),128))],512),[[F,c.value]])]),_(dt,{"available-porters":O.value,"assigned-porters":d.value,onAddPorter:x,onRemovePorter:M},null,8,["available-porters","assigned-porters"]),e("div",_t,[e("button",{class:"btn-primary",onClick:t[2]||(t[2]=a=>B("Day")),disabled:!c.value}," Start Day Shift ",8,yt),e("button",{class:"btn-secondary",onClick:t[3]||(t[3]=a=>B("Night")),disabled:!c.value}," Start Night Shift ",8,bt)])])]))],64))]))}}),Dt=L(wt,[["__scopeId","data-v-396f10cd"]]);export{Dt as default};
