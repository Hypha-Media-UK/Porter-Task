import{a as F,c as l,r as V,h as B,b as i,G as O,e,t as v,A as m,f as U,B as w,F as y,C as M,I as S,o as d,E as _}from"./vendor-d6AZ6u8N.js";import{a as $,u as H,_ as L}from"./index-DclK01DE.js";const E={class:"modal-content"},N={class:"modal-header"},Y={class:"modal-body"},j={class:"form-group"},z=["disabled"],G=["value"],R={key:0,class:"form-note"},q={class:"form-group"},J=["value"],K={class:"form-group"},Q={class:"time-inputs"},W={class:"time-input-group"},X={class:"time-input-group"},Z={class:"form-group"},tt={class:"modal-footer"},et=["disabled"],st=F({__name:"PorterAssignmentModal",props:{editing:{type:Boolean},assignment:{},porters:{}},emits:["save","cancel"],setup(P,{emit:k}){const r=P,b=k,I=$(),D=H(),h=l(()=>I.designationDepartments),T=l(()=>{var s;const o=r.porters||[],t=((s=D.currentShift)==null?void 0:s.assignedPorters)||[];return console.log("MODAL - Porters from props:",o),console.log("MODAL - Porters from shift:",t),console.log("MODAL - All porters:",I.porters),o.length?o:t});l(()=>{const o=D.porterAssignments,t=[...new Set(o.map(s=>s.porterId))];return console.log("Porters with assignments:",t),t});const u=l(()=>r.editing&&r.assignment?[...new Set([r.assignment.porterId,...T.value])]:(console.log("All assigned porters from the shift:",T.value),r.porters||[])),n=V({porterId:"",departmentId:"",startTime:(()=>{const o=new Date,t=o.getHours().toString().padStart(2,"0"),s=o.getMinutes().toString().padStart(2,"0");return`${t}:${s}`})(),endTime:"",notes:""}),A=l(()=>(r.editing,u.value)),x=l(()=>n.value.porterId&&n.value.departmentId&&n.value.startTime);function C(){var p;const o=new Date,t=n.value.startTime.split(":"),s=new Date(o.getFullYear(),o.getMonth(),o.getDate(),parseInt(t[0]),parseInt(t[1])).toISOString();let a;if(n.value.endTime){const g=n.value.endTime.split(":");a=new Date(o.getFullYear(),o.getMonth(),o.getDate(),parseInt(g[0]),parseInt(g[1])).toISOString(),a<s&&(a=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1,parseInt(g[0]),parseInt(g[1])).toISOString())}const f={id:r.editing?(p=r.assignment)==null?void 0:p.id:void 0,porterId:n.value.porterId,departmentId:n.value.departmentId,startTime:s,endTime:a,notes:n.value.notes||void 0};console.log("Saving assignment with porter:",n.value.porterId),b("save",f)}function c(){b("cancel")}return B(()=>{if(r.editing&&r.assignment){const o=new Date(r.assignment.startTime),t=o.getHours().toString().padStart(2,"0"),s=o.getMinutes().toString().padStart(2,"0");if(n.value={porterId:r.assignment.porterId,departmentId:r.assignment.departmentId,startTime:`${t}:${s}`,endTime:"",notes:r.assignment.notes||""},r.assignment.endTime){const a=new Date(r.assignment.endTime),f=a.getHours().toString().padStart(2,"0"),p=a.getMinutes().toString().padStart(2,"0");n.value.endTime=`${f}:${p}`}}}),(o,t)=>(d(),i("div",{class:"modal-backdrop",onClick:O(c,["self"])},[e("div",E,[e("div",N,[e("h3",null,v(o.editing?"Edit Assignment":"Assign Porter to Department"),1),e("button",{class:"btn-close",onClick:c},t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))]),e("div",Y,[e("div",j,[t[8]||(t[8]=e("label",{class:"form-label"},"Porter",-1)),m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.porterId=s),class:"form-control",disabled:u.value.length===0},[t[6]||(t[6]=e("option",{value:"",disabled:""},"Select a porter",-1)),(d(!0),i(y,null,M(A.value,s=>(d(),i("option",{key:s,value:s},v(s),9,G))),128))],8,z),[[w,n.value.porterId]]),!o.editing&&u.value.length===0?(d(),i("div",R,t[7]||(t[7]=[e("em",null,"No available porters. Please add porters to this shift first.",-1)]))):U("",!0)]),e("div",q,[t[10]||(t[10]=e("label",{class:"form-label"},"Department",-1)),m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.departmentId=s),class:"form-control"},[t[9]||(t[9]=e("option",{value:"",disabled:""},"Select a department",-1)),(d(!0),i(y,null,M(h.value,s=>(d(),i("option",{key:s.id,value:s.id,style:_({color:s.color})},v(s.name),13,J))),128))],512),[[w,n.value.departmentId]])]),e("div",K,[t[15]||(t[15]=e("label",{class:"form-label"},"Time Range",-1)),e("div",Q,[e("div",W,[t[11]||(t[11]=e("label",null,"Start Time",-1)),m(e("input",{type:"time","onUpdate:modelValue":t[2]||(t[2]=s=>n.value.startTime=s),class:"form-control"},null,512),[[S,n.value.startTime]])]),t[14]||(t[14]=e("span",{class:"time-separator"},"to",-1)),e("div",X,[t[12]||(t[12]=e("label",null,"End Time (optional)",-1)),m(e("input",{type:"time","onUpdate:modelValue":t[3]||(t[3]=s=>n.value.endTime=s),class:"form-control"},null,512),[[S,n.value.endTime]]),t[13]||(t[13]=e("div",{class:"form-note"},' Leave blank for "until end of shift" ',-1))])])]),e("div",Z,[t[16]||(t[16]=e("label",{class:"form-label"},"Notes (optional)",-1)),m(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.value.notes=s),class:"form-control",rows:"3",placeholder:"Add any specific notes about this assignment..."},null,512),[[S,n.value.notes]])])]),e("div",tt,[e("button",{class:"btn-secondary",onClick:c},"Cancel"),e("button",{class:"btn-primary",onClick:C,disabled:!x.value},v(o.editing?"Update":"Assign"),9,et)])])]))}}),lt=L(st,[["__scopeId","data-v-7f1fc997"]]);export{lt as P};
