import{a as yt,r as h,c as k,b as r,e,f as v,q as wt,D as m,l as N,n as q,t as l,F as y,C as w,k as bt,A as Tt,B as _t,E as H,G as L,H as O,i as Ct,o}from"./vendor-d6AZ6u8N.js";import{L as St}from"./LoadingSpinner-DXicQQVY.js";import{u as At,a as xt,f as G,_ as Mt}from"./index-DclK01DE.js";import{T as Pt}from"./TaskCard-41ii7Wj3.js";import{P as $t}from"./PorterAssignmentModal-tkLghSEs.js";import{S as Dt}from"./ShiftOverview-ujbd4KB4.js";const It={class:"tasks-view"},Et={key:0,class:"shift-dashboard"},Vt={class:"tabs-container"},Ht={class:"tabs"},Bt={key:0,class:"tab-content-container"},Ft={class:"dashboard-card stats-card"},Nt={class:"card-content"},Lt={class:"stats-grid"},Ot={class:"stat-value"},jt={class:"stat-value"},zt={class:"stat-box total"},Rt={class:"stat-value"},Wt={key:0,class:"dashboard-card tasks-card"},Jt={class:"card-content"},Ut={class:"tasks-list"},qt=["onClick"],Gt={key:1,class:"dashboard-card empty-card"},Kt={key:1,class:"tab-content-container"},Yt={class:"dashboard-card porters-card full-width"},Qt={class:"card-header"},Xt={key:0,class:"porter-manager"},Zt={key:0},te={style:{"font-size":"10px",overflow:"auto","max-height":"100px",background:"#f5f5f5",padding:"5px","margin-bottom":"10px"}},ee={class:"porter-selection"},se=["value"],ne=["disabled"],oe={class:"card-content"},re={key:0,class:"empty-state"},ie={key:1,class:"empty-state"},ae={key:2,class:"porter-list"},le=["onClick"],de={class:"porter-avatar"},ue={class:"porter-details"},ce={class:"porter-name"},ve={key:0,class:"porter-assignment"},me=["onClick"],ge={key:1,class:"department-assignments"},pe={class:"departments-grid"},he={class:"department-name"},fe={class:"department-count"},ke={class:"department-content"},ye={key:0,class:"empty-assignments"},we={key:1,class:"assignment-list"},be={class:"assignment-info"},Te={class:"assignment-porter"},_e={class:"assignment-time"},Ce={key:0,class:"assignment-notes"},Se={class:"assignment-actions"},Ae=["onClick"],xe=["onClick"],Me={key:0,class:"timeline-section"},Pe={class:"timeline-container"},$e={class:"timeline"},De={class:"timeline-hours"},Ie={class:"timeline-porter-name"},Ee={class:"timeline-assignments"},Ve=["onClick"],He={key:1,class:"loading-state"},Be={class:"modal-content"},Fe={class:"modal-actions"},Ne={class:"modal-content"},Le={class:"modal-body"},Oe={class:"modal-actions"},je=yt({__name:"TasksView",setup(ze){const g=Ct("navigate"),M=h(!1),T=h(!1),_=h(""),C=h("tasks"),E=h(0),K=h(!0),P=At(),S=xt(),{isLoading:Y,pendingTasks:B,completedTasks:Q,endShift:X,addPorterToShift:Z,removePorterFromShift:tt}=P,d=P.currentShift,{porters:V}=S,et=k(()=>B.slice(0,3)),b=k(()=>!d||!d.assignedPorters?[]:d.assignedPorters);k(()=>(console.log("TasksView - All porters (from settings):",V),console.log("TasksView - Assigned porters (from shift):",b.value),V));const j=k(()=>{if(!d||!d.assignedPorters||!d.porterAssignments)return[];const n=new Date().toISOString(),t=new Set(d.porterAssignments.filter(i=>i.startTime<=n&&(!i.endTime||i.endTime>n)).map(i=>i.porterId));return b.value.filter(i=>!t.has(i))}),st=()=>{g&&g("taskForm")},z=()=>{g&&g("pendingTasks")},nt=()=>{g&&g("completedTasks")},ot=n=>{g&&g("taskForm",{taskId:n})},rt=()=>{M.value=!0},it=()=>{X(),M.value=!1,g&&g("home")},R=n=>{if(!d||!d.porterAssignments)return null;const t=new Date().toISOString(),i=d.porterAssignments.find(s=>s.porterId===n&&s.startTime<=t&&(!s.endTime||s.endTime>t));if(!i)return null;const u=S.designationDepartments.find(s=>s.id===i.departmentId);return u?u.name:null},F=k(()=>!d||!d.porterAssignments?[]:d.porterAssignments),$=h(!1),A=h(void 0),x=h(void 0),D=h(!1),at=k(()=>S.designationDepartments.map(t=>{const i=F.value.filter(u=>u.departmentId===t.id);return{...t,assignments:i}}).sort((t,i)=>i.assignments.length!==t.assignments.length?i.assignments.length-t.assignments.length:t.name.localeCompare(i.name))),lt=k(()=>b.value.map(t=>({id:t,assignments:F.value.filter(i=>i.porterId===t)})).filter(t=>t.assignments.length>0)),W=k(()=>{if(!d)return[];const n=d.type.toLowerCase(),t=S.shifts[n],[i,u]=t.start.split(":"),[s,a]=t.end.split(":"),p=parseInt(i),I=parseInt(s),f=[];if(I<p){for(let c=p;c<24;c++)f.push({hour:c,label:`${c.toString().padStart(2,"0")}`});for(let c=0;c<=I;c++)f.push({hour:c,label:`${c.toString().padStart(2,"0")}`})}else for(let c=p;c<=I;c++)f.push({hour:c,label:`${c.toString().padStart(2,"0")}`});return f}),dt=n=>{const t=new Date(n),i=t.getHours(),u=t.getMinutes(),s=i*60+u,a=24*60;return s/a*100},ut=(n,t)=>{const i=new Date(n);let u;if(t)u=new Date(t);else{const f=d;f&&f.endTime?u=new Date(f.endTime):(u=new Date(i),u.setHours(u.getHours()+2))}const s=i.getHours()*60+i.getMinutes();let p=u.getHours()*60+u.getMinutes()-s;p<0&&(p+=24*60);const I=24*60;return p/I*100},ct=()=>{const n=new Date;console.log("Current local time for marker:",n.getHours()+":"+n.getMinutes(),"("+n.toLocaleTimeString()+")");const t=n.getHours(),i=n.getMinutes(),u=t*60+i,s=24*60;return u/s*100},J=n=>{const t=S.designationDepartments.find(i=>i.id===n);return t?t.name:"Unknown"},vt=n=>{const t=S.designationDepartments.find(i=>i.id===n);return t&&t.color?t.color:"#cccccc"},mt=n=>{$.value=!0,A.value={id:"",porterId:n,departmentId:"",startTime:new Date().toISOString()}},U=n=>{A.value=n,$.value=!0},gt=n=>{x.value=n,D.value=!0},pt=n=>{try{n.id?P.updatePorterAssignment(n.id,{departmentId:n.departmentId,startTime:n.startTime,endTime:n.endTime,notes:n.notes}):P.addPorterAssignment({porterId:n.porterId,departmentId:n.departmentId,startTime:n.startTime,endTime:n.endTime,notes:n.notes}),$.value=!1,A.value=void 0,E.value++}catch(t){console.error("Error saving assignment:",t),alert("Failed to save assignment: "+(t instanceof Error?t.message:String(t)))}},ht=()=>{if(x.value)try{P.deletePorterAssignment(x.value.id),D.value=!1,x.value=void 0,E.value++}catch(n){console.error("Error deleting assignment:",n),alert("Failed to delete assignment: "+(n instanceof Error?n.message:String(n)))}},ft=()=>{if(_.value)try{Z(_.value),_.value="",E.value++}catch(n){console.error("Error adding porter:",n),alert("Failed to add porter: "+(n instanceof Error?n.message:String(n)))}},kt=n=>{try{tt(n),E.value++}catch(t){console.error("Error removing porter:",t),alert("Failed to remove porter: "+(t instanceof Error?t.message:String(t)))}};return(n,t)=>{var i,u;return o(),r("main",It,[t[39]||(t[39]=e("header",{class:"page-header"},[e("h1",null,"Shift Management")],-1)),m(d)?(o(),r("section",Et,[N(Dt,{shift:m(d),showEndButton:!0,variant:"current",onEndShift:rt},null,8,["shift"]),e("div",Vt,[e("div",Ht,[e("button",{class:q(["tab",{active:C.value==="tasks"}]),onClick:t[0]||(t[0]=s=>C.value="tasks")}," Tasks ",2),e("button",{class:q(["tab",{active:C.value==="porters"}]),onClick:t[1]||(t[1]=s=>C.value="porters")}," Porters ",2)])]),C.value==="tasks"?(o(),r("div",Bt,[e("div",Ft,[t[16]||(t[16]=e("div",{class:"card-header"},[e("div",{class:"title-area"},[e("h2",null,"Task Statistics")])],-1)),e("div",Nt,[e("div",Lt,[e("div",{class:"stat-box",onClick:z},[t[11]||(t[11]=e("div",{class:"stat-header"},[e("span",{class:"stat-label"},"Pending Tasks"),e("span",{class:"stat-indicator pending"})],-1)),e("div",Ot,l(m(B).length),1),t[12]||(t[12]=e("div",{class:"stat-action"},"View →",-1))]),e("div",{class:"stat-box",onClick:nt},[t[13]||(t[13]=e("div",{class:"stat-header"},[e("span",{class:"stat-label"},"Completed Tasks"),e("span",{class:"stat-indicator completed"})],-1)),e("div",jt,l(m(Q).length),1),t[14]||(t[14]=e("div",{class:"stat-action"},"View →",-1))]),e("div",zt,[t[15]||(t[15]=e("div",{class:"stat-header"},[e("span",{class:"stat-label"},"Total Tasks"),e("span",{class:"stat-indicator total"})],-1)),e("div",Rt,l(m(d).tasks.length),1)])])])]),m(B).length>0?(o(),r("div",Wt,[e("div",{class:"card-header"},[t[17]||(t[17]=e("div",{class:"title-area"},[e("h2",null,"Recent Tasks")],-1)),e("button",{class:"btn-text",onClick:z},"View All")]),e("div",Jt,[e("div",Ut,[(o(!0),r(y,null,w(et.value,s=>(o(),r("div",{key:s.id,class:"task-item",onClick:a=>ot(s.id)},[N(Pt,{task:s,compact:!0},null,8,["task"])],8,qt))),128))])])])):m(d).tasks.length===0?(o(),r("div",Gt,t[18]||(t[18]=[bt('<div class="card-content centered" data-v-576aeef8><div class="empty-icon" data-v-576aeef8><svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" data-v-576aeef8><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" data-v-576aeef8></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1" data-v-576aeef8></rect><path d="M12 11v6" data-v-576aeef8></path><path d="M9 18h6" data-v-576aeef8></path></svg></div><h3 data-v-576aeef8>No Tasks Yet</h3><p data-v-576aeef8>Click the + button to create your first task</p></div>',1)]))):v("",!0)])):C.value==="porters"?(o(),r("div",Kt,[e("div",Yt,[e("div",Qt,[t[19]||(t[19]=e("div",{class:"title-area"},[e("h2",null,"Porters Management")],-1)),T.value?(o(),r("button",{key:1,class:"btn-secondary",onClick:t[3]||(t[3]=s=>T.value=!1)}," Done ")):(o(),r("button",{key:0,class:"btn-primary",onClick:t[2]||(t[2]=s=>T.value=!0)}," Add Porter "))]),T.value?(o(),r("div",Xt,[K.value?(o(),r("div",Zt,[e("pre",te,"All porters: "+l(JSON.stringify(m(V)))+`
Assigned porters: `+l(JSON.stringify(b.value))+`
    `,1)])):v("",!0),e("div",ee,[Tt(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>_.value=s),class:"form-control"},[t[20]||(t[20]=e("option",{value:"",disabled:""},"Select porter to add",-1)),(o(!0),r(y,null,w(m(V),s=>(o(),r("option",{key:s,value:s},l(s),9,se))),128))],512),[[_t,_.value]]),e("button",{class:"btn-primary",onClick:ft,disabled:!_.value}," Add ",8,ne)])])):v("",!0),t[29]||(t[29]=e("h3",{class:"section-subheading"},"Available Porters",-1)),e("div",oe,[b.value.length===0?(o(),r("div",re,[t[21]||(t[21]=e("p",null,"No porters assigned to this shift.",-1)),T.value?v("",!0):(o(),r("button",{key:0,class:"btn-outline",onClick:t[5]||(t[5]=s=>T.value=!0)},"Assign Porters"))])):j.value.length===0?(o(),r("div",ie,t[22]||(t[22]=[e("p",null,"All porters are currently assigned to departments.",-1)]))):(o(),r("div",ae,[(o(!0),r(y,null,w(j.value,s=>(o(),r("div",{key:s,class:"porter-tag available",onClick:a=>mt(s)},[e("div",de,l(s.charAt(0)),1),e("div",ue,[e("span",ce,l(s),1),R(s)?(o(),r("span",ve," Currently: "+l(R(s)),1)):v("",!0)]),e("button",{class:"btn-icon remove-porter",onClick:L(a=>kt(s),["stop"]),title:"Remove porter"},t[23]||(t[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]),8,me)],8,le))),128))]))]),b.value.length>0?(o(),r("div",ge,[t[28]||(t[28]=e("h3",{class:"section-subheading"},"Department Assignments",-1)),e("div",pe,[(o(!0),r(y,null,w(at.value,s=>(o(),r("div",{key:s.id,class:"department-card"},[e("div",{class:"department-header",style:H({backgroundColor:s.color?`${s.color}22`:"#f0f0f0",color:s.color||"#666"})},[e("span",he,l(s.name),1),e("span",fe,l(s.assignments.length)+" Porter"+l(s.assignments.length!==1?"s":""),1)],4),e("div",ke,[s.assignments.length===0?(o(),r("div",ye,t[24]||(t[24]=[e("p",null,"No porters assigned to this department",-1)]))):(o(),r("div",we,[(o(!0),r(y,null,w(s.assignments,a=>(o(),r("div",{key:a.id,class:"assignment-item"},[e("div",be,[e("div",Te,l(a.porterId),1),e("div",_e,l(m(G)(new Date(a.startTime)))+" "+l(a.endTime?` - ${m(G)(new Date(a.endTime))}`:"")+" "+l(a.endTime?"":"(until end of shift)"),1),a.notes?(o(),r("div",Ce,l(a.notes),1)):v("",!0)]),e("div",Se,[e("button",{class:"btn-icon",onClick:p=>U(a),title:"Edit assignment"},t[25]||(t[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)]),8,Ae),e("button",{class:"btn-icon",onClick:p=>gt(a),title:"Delete assignment"},t[26]||(t[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)]),8,xe)])]))),128))]))])]))),128))]),F.value.length>0?(o(),r("div",Me,[t[27]||(t[27]=e("h3",{class:"section-subheading"},"Timeline View",-1)),e("div",Pe,[e("div",$e,[e("div",De,[(o(!0),r(y,null,w(W.value,s=>(o(),r("div",{key:s.label,class:"timeline-hour",style:H({width:`${100/W.value.length}%`})},l(s.label),5))),128))]),(o(!0),r(y,null,w(lt.value,s=>(o(),r("div",{key:s.id,class:"timeline-porter"},[e("div",Ie,l(s.id),1),e("div",Ee,[(o(!0),r(y,null,w(s.assignments,a=>(o(),r("div",{key:a.id,class:"timeline-assignment",style:H({left:`${dt(a.startTime)}%`,width:`${ut(a.startTime,a.endTime)}%`,backgroundColor:vt(a.departmentId)}),onClick:p=>U(a)},l(J(a.departmentId)),13,Ve))),128))])]))),128)),e("div",{class:"current-time-marker",style:H({left:`${ct()}%`})},null,4)])])])):v("",!0)])):v("",!0)])])):v("",!0)])):m(Y)?(o(),r("section",He,[N(St,{message:"Loading shift data..."})])):v("",!0),e("button",{class:"fab",onClick:st,"aria-label":"Create new task"},t[30]||(t[30]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])),M.value?(o(),r("div",{key:2,class:"modal-backdrop",onClick:t[7]||(t[7]=L(s=>M.value=!1,["self"]))},[e("div",Be,[t[31]||(t[31]=e("div",{class:"modal-handle"},null,-1)),t[32]||(t[32]=e("div",{class:"modal-header"},[e("h3",null,"End Shift?")],-1)),t[33]||(t[33]=e("div",{class:"modal-body"},[e("p",null,"Are you sure you want to end the current shift? This action cannot be undone.")],-1)),e("div",Fe,[e("button",{class:"btn-secondary",onClick:t[6]||(t[6]=s=>M.value=!1)}," Cancel "),e("button",{class:"btn-danger",onClick:it}," End Shift ")])])])):v("",!0),$.value?(o(),wt($t,{key:3,editing:!!A.value,assignment:A.value,porters:b.value,onSave:pt,onCancel:t[8]||(t[8]=()=>{$.value=!1,A.value=void 0})},null,8,["editing","assignment","porters"])):v("",!0),D.value?(o(),r("div",{key:4,class:"modal-backdrop",onClick:t[10]||(t[10]=L(s=>D.value=!1,["self"]))},[e("div",Ne,[t[37]||(t[37]=e("div",{class:"modal-handle"},null,-1)),t[38]||(t[38]=e("div",{class:"modal-header"},[e("h3",null,"Delete Assignment")],-1)),e("div",Le,[e("p",null,[t[34]||(t[34]=O(" Are you sure you want to remove ")),e("strong",null,l((i=x.value)==null?void 0:i.porterId),1),t[35]||(t[35]=O(" from the ")),e("strong",null,l(J(((u=x.value)==null?void 0:u.departmentId)||"")),1),t[36]||(t[36]=O(" department? "))])]),e("div",Oe,[e("button",{class:"btn-secondary",onClick:t[9]||(t[9]=s=>D.value=!1)},"Cancel"),e("button",{class:"btn-danger",onClick:ht},"Delete")])])])):v("",!0)])}}}),Ye=Mt(je,[["__scopeId","data-v-576aeef8"]]);export{Ye as default};
