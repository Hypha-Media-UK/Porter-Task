const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomeView-yfuiFtYB.js","assets/vendor-d6AZ6u8N.js","assets/LoadingSpinner-DATLn-f0.js","assets/LoadingSpinner-Bu4nEbl1.css","assets/ShiftOverview-C-6JzSaX.js","assets/ShiftOverview-BPpuBwK4.css","assets/HomeView-BYpt05IN.css","assets/TasksView-B-Ge2RCQ.js","assets/TaskCard-B4MCsFsY.js","assets/TaskCard-CXpPmzi5.css","assets/PorterAssignmentModal-BCJixM4-.js","assets/PorterAssignmentModal-DTssx3Xn.css","assets/TasksView-DauEm4eJ.css","assets/PendingTasksView-C5RbsTsh.js","assets/PendingTasksView-B07Tbldu.css","assets/CompletedTasksView-FLnKflQE.js","assets/CompletedTasksView-DockZU4T.css","assets/TaskFormView-RZHbZGq6.js","assets/TaskFormView-B2-1khap.css","assets/ArchiveView-TO0kh7Cn.js","assets/ArchiveView-sxVhN_fO.css","assets/ShiftDetailView-XqbI0rzn.js","assets/ShiftDetailView-CTTi2Tcx.css","assets/SettingsView-dSrE3VrF.js","assets/SettingsView-BSvg1TP5.css"])))=>i.map(i=>d[i]);
var As=Object.defineProperty;var Ps=(s,e,t)=>e in s?As(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var ue=(s,e,t)=>Ps(s,typeof e!="symbol"?e+"":e,t);import{r as $,c as V,d as lr,a as pt,i as Mt,b as x,e as A,f as pe,n as st,t as me,g as Os,o as C,h as cr,j as js,k as Jt,w as $s,l as Re,m as Qe,p as Is,F as Cs,u as xs,T as Rs,q as Ls,s as Ds,v as Us,x as Fs,y as Bs,z as Ns}from"./vendor-d6AZ6u8N.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const h=$(null),j=$([]),je=$(!1),it=$(null),nt=$(!1),vt="porter-track-current-shift",ur="porter-track-archived-shifts",Y="porter-track-current-shift-id",qs=V(()=>{var e,t,r;const s=!!h.value&&h.value.isActive===!0;return console.log("isShiftActive evaluation:",{result:s,currentShiftExists:!!h.value,currentShiftId:(e=h.value)==null?void 0:e.id,endTime:(t=h.value)==null?void 0:t.endTime,isActive:(r=h.value)==null?void 0:r.isActive}),s}),Ms=V(()=>h.value?h.value.tasks.filter(s=>s.status==="Pending"):[]),Js=V(()=>h.value?h.value.tasks.filter(s=>s.status==="Completed"):[]),zs=V(()=>!h.value||!h.value.porterAssignments?[]:h.value.porterAssignments),Hs=V(()=>{if(!h.value||!h.value.porterAssignments)return[];const s=new Date().toISOString();return h.value.porterAssignments.filter(e=>{const t=e.startTime<=s,r=!e.endTime||e.endTime>s;return t&&r})});function O(){h.value&&(localStorage.setItem(vt,JSON.stringify(h.value)),sessionStorage.setItem(Y,h.value.id))}function Q(){localStorage.setItem(ur,JSON.stringify(j.value))}function zt(){localStorage.removeItem(vt),sessionStorage.removeItem(Y)}function Z(){h.value&&(h.value={...h.value,tasks:[...h.value.tasks]})}function Ee(s){return s.assignedPorters||(s.assignedPorters=[]),s.porterAssignments||(s.porterAssignments=[]),s.tasks||(s.tasks=[]),s}const Vs="modulepreload",Gs=function(s){return"/"+s},Ht={},R=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(l=>{if(l=Gs(l),l in Ht)return;Ht[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Vs,c||(f.as="script"),f.crossOrigin="",f.href=l,a&&f.setAttribute("nonce",a),document.head.appendChild(f),c)return new Promise((v,p)=>{f.addEventListener("load",v),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})},Ks=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>R(async()=>{const{default:r}=await Promise.resolve().then(()=>we);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class mt extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Ws extends mt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Qs extends mt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ys extends mt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ot;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(ot||(ot={}));var Xs=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};class Zs{constructor(e,{headers:t={},customFetch:r,region:i=ot.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Ks(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Xs(this,void 0,void 0,function*(){try{const{headers:i,method:n,body:o}=t;let a={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),i),body:c}).catch(w=>{throw new Ws(w)}),f=u.headers.get("x-relay-error");if(f&&f==="true")throw new Qs(u);if(!u.ok)throw new Ys(u);let v=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),p;return v==="application/json"?p=yield u.json():v==="application/octet-stream"?p=yield u.blob():v==="text/event-stream"?p=u:v==="multipart/form-data"?p=yield u.formData():p=yield u.text(),{data:p,error:null}}catch(i){return{data:null,error:i}}})}}var J=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ja(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function ei(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var i=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return s[r]}})}),t}var U={},_t={},Me={},Ie={},Je={},ze={},ti=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ye=ti();const ri=ye.fetch,dr=ye.fetch.bind(ye),hr=ye.Headers,si=ye.Request,ii=ye.Response,we=Object.freeze(Object.defineProperty({__proto__:null,Headers:hr,Request:si,Response:ii,default:dr,fetch:ri},Symbol.toStringTag,{value:"Module"})),ni=ei(we);var He={};Object.defineProperty(He,"__esModule",{value:!0});let oi=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};He.default=oi;var fr=J&&J.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ze,"__esModule",{value:!0});const ai=fr(ni),li=fr(He);let ci=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ai.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let i=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var o,a,l;let c=null,u=null,f=null,v=n.status,p=n.statusText;if(n.ok){if(this.method!=="HEAD"){const L=await n.text();L===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=L:u=JSON.parse(L))}const E=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),b=(a=n.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");E&&b&&b.length>1&&(f=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,f=null,v=406,p="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const E=await n.text();try{c=JSON.parse(E),Array.isArray(c)&&n.status===404&&(u=[],c=null,v=200,p="OK")}catch{n.status===404&&E===""?(v=204,p="No Content"):c={message:E}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,v=200,p="OK"),c&&this.shouldThrowOnError)throw new li.default(c)}return{error:c,data:u,count:f,status:v,statusText:p}});return this.shouldThrowOnError||(i=i.catch(n=>{var o,a,l;return{error:{message:`${(o=n==null?void 0:n.name)!==null&&o!==void 0?o:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(a=n==null?void 0:n.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=n==null?void 0:n.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}returns(){return this}overrideTypes(){return this}};ze.default=ci;var ui=J&&J.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Je,"__esModule",{value:!0});const di=ui(ze);let hi=class extends di.default{select(e){let t=!1;const r=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:i,referencedTable:n=i}={}){const o=n?`${n}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:i=r}={}){const n=typeof i>"u"?"offset":`${i}.offset`,o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:i=!1,wal:n=!1,format:o="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${c}"; options=${l};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Je.default=hi;var fi=J&&J.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ie,"__esModule",{value:!0});const gi=fi(Je);let pi=class extends gi.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:i}={}){let n="";i==="plain"?n="pl":i==="phrase"?n="ph":i==="websearch"&&(n="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const i=r?`${r}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};Ie.default=pi;var vi=J&&J.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Me,"__esModule",{value:!0});const Se=vi(Ie);let mi=class{constructor(e,{headers:t={},schema:r,fetch:i}){this.url=e,this.headers=t,this.schema=r,this.fetch=i}select(e,{head:t=!1,count:r}={}){const i=t?"HEAD":"GET";let n=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new Se.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const i="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Se.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:i,defaultToNull:n=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new Se.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new Se.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Se.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Me.default=mi;var Ve={},Ge={};Object.defineProperty(Ge,"__esModule",{value:!0});Ge.version=void 0;Ge.version="0.0.0-automated";Object.defineProperty(Ve,"__esModule",{value:!0});Ve.DEFAULT_HEADERS=void 0;const _i=Ge;Ve.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${_i.version}`};var gr=J&&J.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(_t,"__esModule",{value:!0});const yi=gr(Me),wi=gr(Ie),bi=Ve;let Si=class pr{constructor(e,{headers:t={},schema:r,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},bi.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new yi.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new pr(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:i=!1,count:n}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let l;r||i?(o=r?"HEAD":"GET",Object.entries(t).filter(([u,f])=>f!==void 0).map(([u,f])=>[u,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([u,f])=>{a.searchParams.append(u,f)})):(o="POST",l=t);const c=Object.assign({},this.headers);return n&&(c.Prefer=`count=${n}`),new wi.default({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};_t.default=Si;var be=J&&J.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(U,"__esModule",{value:!0});U.PostgrestError=U.PostgrestBuilder=U.PostgrestTransformBuilder=U.PostgrestFilterBuilder=U.PostgrestQueryBuilder=U.PostgrestClient=void 0;const vr=be(_t);U.PostgrestClient=vr.default;const mr=be(Me);U.PostgrestQueryBuilder=mr.default;const _r=be(Ie);U.PostgrestFilterBuilder=_r.default;const yr=be(Je);U.PostgrestTransformBuilder=yr.default;const wr=be(ze);U.PostgrestBuilder=wr.default;const br=be(He);U.PostgrestError=br.default;var ki=U.default={PostgrestClient:vr.default,PostgrestQueryBuilder:mr.default,PostgrestFilterBuilder:_r.default,PostgrestTransformBuilder:yr.default,PostgrestBuilder:wr.default,PostgrestError:br.default};const{PostgrestClient:Ei,PostgrestQueryBuilder:La,PostgrestFilterBuilder:Da,PostgrestTransformBuilder:Ua,PostgrestBuilder:Fa,PostgrestError:Ba}=ki,Ti="2.11.2",Ai={"X-Client-Info":`realtime-js/${Ti}`},Pi="1.0.0",Sr=1e4,Oi=1e3;var _e;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(_e||(_e={}));var N;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(N||(N={}));var H;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(H||(H={}));var at;(function(s){s.websocket="websocket"})(at||(at={}));var le;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(le||(le={}));class ji{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const i=t.getUint8(1),n=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+i));o=o+i;const l=r.decode(e.slice(o,o+n));o=o+n;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class kr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var P;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(P||(P={}));const Vt=(s,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((n,o)=>(n[o]=$i(o,s,e,i),n),{})},$i=(s,e,t,r)=>{const i=e.find(a=>a.name===s),n=i==null?void 0:i.type,o=t[s];return n&&!r.includes(n)?Er(n,o):lt(o)},Er=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return Ri(e,t)}switch(s){case P.bool:return Ii(e);case P.float4:case P.float8:case P.int2:case P.int4:case P.int8:case P.numeric:case P.oid:return Ci(e);case P.json:case P.jsonb:return xi(e);case P.timestamp:return Li(e);case P.abstime:case P.date:case P.daterange:case P.int4range:case P.int8range:case P.money:case P.reltime:case P.text:case P.time:case P.timestamptz:case P.timetz:case P.tsrange:case P.tstzrange:return lt(e);default:return lt(e)}},lt=s=>s,Ii=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Ci=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},xi=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},Ri=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let n;const o=s.slice(1,t);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>Er(e,a))}return s},Li=s=>typeof s=="string"?s.replace(" ","T"):s,Tr=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ye{constructor(e,t,r={},i=Sr){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Gt;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Gt||(Gt={}));class Te{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Te.syncState(this.state,i,n,o),this.pendingDiffs.forEach(l=>{this.state=Te.syncDiff(this.state,l,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Te.syncDiff(this.state,i,n,o),a())}),this.onJoin((i,n,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:o})}),this.onLeave((i,n,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const n=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(n,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const f=n[c];if(f){const v=u.map(b=>b.presence_ref),p=f.map(b=>b.presence_ref),w=u.filter(b=>p.indexOf(b.presence_ref)<0),E=f.filter(b=>v.indexOf(b.presence_ref)<0);w.length>0&&(a[c]=w),E.length>0&&(l[c]=E)}else a[c]=u}),this.syncDiff(n,{joins:a,leaves:l},r,i)}static syncDiff(e,t,r,i){const{joins:n,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(n,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const f=e[a].map(p=>p.presence_ref),v=u.filter(p=>f.indexOf(p.presence_ref)<0);e[a].unshift(...v)}r(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(f=>f.presence_ref);c=c.filter(f=>u.indexOf(f.presence_ref)<0),e[a]=c,i(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Kt;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Kt||(Kt={}));var Wt;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Wt||(Wt={}));var X;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(X||(X={}));class yt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=N.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ye(this,H.join,this.params,this.timeout),this.rejoinTimer=new kr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=N.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=N.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=N.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=N.errored,this.rejoinTimer.scheduleTimeout())}),this._on(H.reply,{},(i,n)=>{this._trigger(this._replyEventName(n),i)}),this.presence=new Te(this),this.broadcastEndpointURL=Tr(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:o,private:a}}=this.params;this._onError(u=>e==null?void 0:e(X.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(X.CLOSED));const l={},c={broadcast:n,presence:o,postgres_changes:(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&i!==void 0?i:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var f;if(this.socket.setAuth(),u===void 0){e==null||e(X.SUBSCRIBED);return}else{const v=this.bindings.postgres_changes,p=(f=v==null?void 0:v.length)!==null&&f!==void 0?f:0,w=[];for(let E=0;E<p;E++){const b=v[E],{filter:{event:L,schema:z,table:q,filter:F}}=b,B=u&&u[E];if(B&&B.event===L&&B.schema===z&&B.table===q&&B.filter===F)w.push(Object.assign(Object.assign({},b),{id:B.id}));else{this.unsubscribe(),e==null||e(X.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=w,e&&e(X.SUBSCRIBED);return}}).receive("error",u=>{e==null||e(X.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(X.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),c.receive("ok",()=>n("ok")),c.receive("error",()=>n("error")),c.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=N.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(H.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const i=new Ye(this,H.leave,{},e);i.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const i=new AbortController,n=setTimeout(()=>i.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Ye(this,e,t,r);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,n;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=H;if(r&&[a,l,c,u].indexOf(o)>=0&&r!==this._joinRef())return;let v=this._onMessage(o,t,r);if(t&&!v)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var w,E,b;return((w=p.filter)===null||w===void 0?void 0:w.event)==="*"||((b=(E=p.filter)===null||E===void 0?void 0:E.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===o}).map(p=>p.callback(v,r)):(n=this.bindings[o])===null||n===void 0||n.filter(p=>{var w,E,b,L,z,q;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const F=p.id,B=(w=p.filter)===null||w===void 0?void 0:w.event;return F&&((E=t.ids)===null||E===void 0?void 0:E.includes(F))&&(B==="*"||(B==null?void 0:B.toLocaleLowerCase())===((b=t.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const F=(z=(L=p==null?void 0:p.filter)===null||L===void 0?void 0:L.event)===null||z===void 0?void 0:z.toLocaleLowerCase();return F==="*"||F===((q=t==null?void 0:t.event)===null||q===void 0?void 0:q.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof v=="object"&&"ids"in v){const w=v.data,{schema:E,table:b,commit_timestamp:L,type:z,errors:q}=w;v=Object.assign(Object.assign({},{schema:E,table:b,commit_timestamp:L,eventType:z,new:{},old:{},errors:q}),this._getPayloadRecords(w))}p.callback(v,r)})}_isClosed(){return this.state===N.closed}_isJoined(){return this.state===N.joined}_isJoining(){return this.state===N.joining}_isLeaving(){return this.state===N.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&yt.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(H.close,{},e)}_onError(e){this._on(H.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=N.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Vt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Vt(e.columns,e.old_record)),t}}const Di=()=>{},Ui=typeof WebSocket<"u",Fi=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Bi{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Ai,this.params={},this.timeout=Sr,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Di,this.conn=null,this.sendBuffer=[],this.serializer=new ji,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...a)=>R(async()=>{const{default:l}=await Promise.resolve().then(()=>we);return{default:l}},void 0).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${at.websocket}`,this.httpEndpoint=Tr(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,o)=>o(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new kr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Ui){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Ni(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),R(async()=>{const{default:e}=await import("./browser-DKc3GbrF.js").then(t=>t.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Pi}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case _e.connecting:return le.Connecting;case _e.open:return le.Open;case _e.closing:return le.Closing;default:return le.Closed}}isConnected(){return this.connectionState()===le.Open}channel(e,t={config:{}}){const r=new yt(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:i,ref:n}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${n})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(i=>{t&&i.updateJoinPayload({access_token:t}),i.joinedOnce&&i._isJoined()&&i._push(H.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Oi,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:i,payload:n,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${r} ${i} ${o&&"("+o+")"||""}`,n),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(i,n,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(H.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Fi],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Ni{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=_e.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class wt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function I(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class qi extends wt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ct extends wt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Mi=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};const Ar=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>R(async()=>{const{default:r}=await Promise.resolve().then(()=>we);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ji=()=>Mi(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield R(()=>Promise.resolve().then(()=>we),void 0)).Response:Response}),ut=s=>{if(Array.isArray(s))return s.map(t=>ut(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[i]=ut(r)}),e};var ce=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};const Xe=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),zi=(s,e,t)=>ce(void 0,void 0,void 0,function*(){const r=yield Ji();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(i=>{e(new qi(Xe(i),s.status||500))}).catch(i=>{e(new ct(Xe(i),i))}):e(new ct(Xe(s),s))}),Hi=(s,e,t,r)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(i.body=JSON.stringify(r)),Object.assign(Object.assign({},i),t))};function Ce(s,e,t,r,i,n){return ce(this,void 0,void 0,function*(){return new Promise((o,a)=>{s(t,Hi(e,r,i,n)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>zi(l,a,r))})})}function Be(s,e,t,r){return ce(this,void 0,void 0,function*(){return Ce(s,"GET",e,t,r)})}function re(s,e,t,r,i){return ce(this,void 0,void 0,function*(){return Ce(s,"POST",e,r,i,t)})}function Vi(s,e,t,r,i){return ce(this,void 0,void 0,function*(){return Ce(s,"PUT",e,r,i,t)})}function Gi(s,e,t,r){return ce(this,void 0,void 0,function*(){return Ce(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Pr(s,e,t,r,i){return ce(this,void 0,void 0,function*(){return Ce(s,"DELETE",e,r,i,t)})}var D=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};const Ki={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Qt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Wi{constructor(e,t={},r,i){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Ar(i)}uploadOrUpdate(e,t,r,i){return D(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},Qt),i);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),l&&n.append("metadata",this.encodeMetadata(l)),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",o.cacheControl),l&&n.append("metadata",this.encodeMetadata(l))):(n=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),i!=null&&i.headers&&(a=Object.assign(Object.assign({},a),i.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),f=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:n,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),v=yield f.json();return f.ok?{data:{path:c,id:v.Id,fullPath:v.Key},error:null}:{data:null,error:v}}catch(n){if(I(n))return{data:null,error:n};throw n}})}upload(e,t,r){return D(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,i){return D(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),o=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Qt.upsert},i),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const f=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),v=yield f.json();return f.ok?{data:{path:n,fullPath:v.Key},error:null}:{data:null,error:v}}catch(l){if(I(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return D(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const n=yield re(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),o=new URL(this.url+n.url),a=o.searchParams.get("token");if(!a)throw new wt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(I(r))return{data:null,error:r};throw r}})}update(e,t,r){return D(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return D(this,void 0,void 0,function*(){try{return{data:yield re(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(I(i))return{data:null,error:i};throw i}})}copy(e,t,r){return D(this,void 0,void 0,function*(){try{return{data:{path:(yield re(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(I(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,r){return D(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield re(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(i){if(I(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return D(this,void 0,void 0,function*(){try{const i=yield re(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${n}`):null})),error:null}}catch(i){if(I(i))return{data:null,error:i};throw i}})}download(e,t){return D(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=n?`?${n}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Be(this.fetch,`${this.url}/${i}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(I(a))return{data:null,error:a};throw a}})}info(e){return D(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Be(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ut(r),error:null}}catch(r){if(I(r))return{data:null,error:r};throw r}})}exists(e){return D(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Gi(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(I(r)&&r instanceof ct){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&i.push(l);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return D(this,void 0,void 0,function*(){try{return{data:yield Pr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(I(t))return{data:null,error:t};throw t}})}list(e,t,r){return D(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Ki),t),{prefix:e||""});return{data:yield re(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(I(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Qi="2.7.1",Yi={"X-Client-Info":`storage-js/${Qi}`};var de=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};class Xi{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Yi),t),this.fetch=Ar(r)}listBuckets(){return de(this,void 0,void 0,function*(){try{return{data:yield Be(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(I(e))return{data:null,error:e};throw e}})}getBucket(e){return de(this,void 0,void 0,function*(){try{return{data:yield Be(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(I(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return de(this,void 0,void 0,function*(){try{return{data:yield re(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(I(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return de(this,void 0,void 0,function*(){try{return{data:yield Vi(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(I(r))return{data:null,error:r};throw r}})}emptyBucket(e){return de(this,void 0,void 0,function*(){try{return{data:yield re(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(I(t))return{data:null,error:t};throw t}})}deleteBucket(e){return de(this,void 0,void 0,function*(){try{return{data:yield Pr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(I(t))return{data:null,error:t};throw t}})}}class Zi extends Xi{constructor(e,t={},r){super(e,t,r)}from(e){return new Wi(this.url,this.headers,e,this.fetch)}}const en="2.49.4";let ke="";typeof Deno<"u"?ke="deno":typeof document<"u"?ke="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ke="react-native":ke="node";const tn={"X-Client-Info":`supabase-js-${ke}/${en}`},rn={headers:tn},sn={schema:"public"},nn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},on={};var an=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};const ln=s=>{let e;return s?e=s:typeof fetch>"u"?e=dr:e=fetch,(...t)=>e(...t)},cn=()=>typeof Headers>"u"?hr:Headers,un=(s,e,t)=>{const r=ln(t),i=cn();return(n,o)=>an(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:s;let c=new i(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",s),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(n,Object.assign(Object.assign({},o),{headers:c}))})};var dn=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};function hn(s){return s.replace(/\/$/,"")}function fn(s,e){const{db:t,auth:r,realtime:i,global:n}=s,{db:o,auth:a,realtime:l,global:c}=e,u={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},c),n),accessToken:()=>dn(this,void 0,void 0,function*(){return""})};return s.accessToken?u.accessToken=s.accessToken:delete u.accessToken,u}const Or="2.69.1",ge=30*1e3,dt=3,Ze=dt*ge,gn="http://localhost:9999",pn="supabase.auth.token",vn={"X-Client-Info":`gotrue-js/${Or}`},ht="X-Supabase-Api-Version",jr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},mn=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,_n=6e5;class bt extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function S(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class yn extends bt{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function wn(s){return S(s)&&s.name==="AuthApiError"}class $r extends bt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ie extends bt{constructor(e,t,r,i){super(e,r,i),this.name=t,this.status=r}}class ee extends ie{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function bn(s){return S(s)&&s.name==="AuthSessionMissingError"}class et extends ie{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Le extends ie{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class De extends ie{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Sn(s){return S(s)&&s.name==="AuthImplicitGrantRedirectError"}class Yt extends ie{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ft extends ie{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function tt(s){return S(s)&&s.name==="AuthRetryableFetchError"}class Xt extends ie{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Ae extends ie{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Zt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),er=` 	
\r=`.split(""),kn=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<er.length;e+=1)s[er[e].charCodeAt(0)]=-2;for(let e=0;e<Zt.length;e+=1)s[Zt[e].charCodeAt(0)]=e;return s})();function Ir(s,e,t){const r=kn[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function tr(s){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=o=>{An(o,r,t)};for(let o=0;o<s.length;o+=1)Ir(s.charCodeAt(o),i,n);return e.join("")}function En(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Tn(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}En(r,e)}}function An(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if(!(s>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Pn(s){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<s.length;i+=1)Ir(s.charCodeAt(i),t,r);return new Uint8Array(e)}function On(s){const e=[];return Tn(s,t=>e.push(t)),new Uint8Array(e)}function jn(s){return Math.round(Date.now()/1e3)+s}function $n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const W=()=>typeof window<"u"&&typeof document<"u",oe={tested:!1,writable:!1},Pe=()=>{if(!W())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(oe.tested)return oe.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),oe.tested=!0,oe.writable=!0}catch{oe.tested=!0,oe.writable=!1}return oe.writable};function In(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const Cr=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>R(async()=>{const{default:r}=await Promise.resolve().then(()=>we);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Cn=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",xr=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},Ue=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Fe=async(s,e)=>{await s.removeItem(e)};class Ke{constructor(){this.promise=new Ke.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ke.promiseConstructor=Promise;function rt(s){const e=s.split(".");if(e.length!==3)throw new Ae("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!mn.test(e[r]))throw new Ae("JWT not in base64url format");return{header:JSON.parse(tr(e[0])),payload:JSON.parse(tr(e[1])),signature:Pn(e[2]),raw:{header:e[0],payload:e[1]}}}async function xn(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function Rn(s,e){return new Promise((r,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const o=await s(n);if(!e(n,null,o)){r(o);return}}catch(o){if(!e(n,o)){i(o);return}}})()})}function Ln(s){return("0"+s.toString(16)).substr(-2)}function Dn(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,Ln).join("")}async function Un(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}async function Fn(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await Un(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function he(s,e,t=!1){const r=Dn();let i=r;t&&(i+="/PASSWORD_RECOVERY"),await xr(s,`${e}-code-verifier`,i);const n=await Fn(r);return[n,r===n?"plain":"s256"]}const Bn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Nn(s){const e=s.headers.get(ht);if(!e||!e.match(Bn))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function qn(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function Mn(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var Jn=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(s);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(s,r[i])&&(t[r[i]]=s[r[i]]);return t};const ae=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),zn=[502,503,504];async function rr(s){var e;if(!Cn(s))throw new ft(ae(s),0);if(zn.includes(s.status))throw new ft(ae(s),s.status);let t;try{t=await s.json()}catch(n){throw new $r(ae(n),n)}let r;const i=Nn(s);if(i&&i.getTime()>=jr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Xt(ae(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new ee}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,o)=>n&&typeof o=="string",!0))throw new Xt(ae(t),s.status,t.weak_password.reasons);throw new yn(ae(t),s.status||500,r)}const Hn=(s,e,t,r)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function k(s,e,t,r){var i;const n=Object.assign({},r==null?void 0:r.headers);n[ht]||(n[ht]=jr["2024-01-01"].name),r!=null&&r.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const o=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Vn(s,e,t+a,{headers:n,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function Vn(s,e,t,r,i,n){const o=Hn(e,r,i,n);let a;try{a=await s(t,Object.assign({},o))}catch(l){throw console.error(l),new ft(ae(l),0)}if(a.ok||await rr(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await rr(l)}}function te(s){var e;let t=null;Qn(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=jn(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function sr(s){const e=te(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function se(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function Gn(s){return{data:s,error:null}}function Kn(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:n}=s,o=Jn(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:n},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Wn(s){return s}function Qn(s){return s.access_token&&s.refresh_token&&s.expires_in}var Yn=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(s);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(s,r[i])&&(t[r[i]]=s[r[i]]);return t};class Xn{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Cr(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await k(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(S(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await k(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:se})}catch(r){if(S(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Yn(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await k(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Kn,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(S(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await k(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:se})}catch(t){if(S(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,n,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await k(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:Wn});if(u.error)throw u.error;const f=await u.json(),v=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(w=>{const E=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(w.split(";")[1].split("=")[1]);c[`${b}Page`]=E}),c.total=parseInt(v)),{data:Object.assign(Object.assign({},f),c),error:null}}catch(c){if(S(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await k(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:se})}catch(t){if(S(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await k(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:se})}catch(r){if(S(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await k(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:se})}catch(r){if(S(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await k(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(S(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await k(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(S(t))return{data:null,error:t};throw t}}}const Zn={getItem:s=>Pe()?globalThis.localStorage.getItem(s):null,setItem:(s,e)=>{Pe()&&globalThis.localStorage.setItem(s,e)},removeItem:s=>{Pe()&&globalThis.localStorage.removeItem(s)}};function ir(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function eo(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const fe={debug:!!(globalThis&&Pe()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Rr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class to extends Rr{}async function ro(s,e,t){fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),fe.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,i.name);try{return await t()}finally{fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,i.name)}}else{if(e===0)throw fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new to(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(fe.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}eo();const so={url:gn,storageKey:pn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:vn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function nr(s,e,t){return await t()}class $e{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=$e.nextInstanceID,$e.nextInstanceID+=1,this.instanceID>0&&W()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},so),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Xn({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Cr(i.fetch),this.lock=i.lock||nr,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:W()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ro:this.lock=nr,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:Pe()?this.storage=Zn:(this.memoryStorage={},this.storage=ir(this.memoryStorage)):(this.memoryStorage={},this.storage=ir(this.memoryStorage)),W()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Or}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=In(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),W()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),Sn(n)){const l=(e=n.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:o,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return S(t)?{error:t}:{error:new $r("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,i;try{const n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:te}),{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(S(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,i;try{let n;if("email"in e){const{email:u,password:f,options:v}=e;let p=null,w=null;this.flowType==="pkce"&&([p,w]=await he(this.storage,this.storageKey)),n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:v==null?void 0:v.emailRedirectTo,body:{email:u,password:f,data:(t=v==null?void 0:v.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},code_challenge:p,code_challenge_method:w},xform:te})}else if("phone"in e){const{phone:u,password:f,options:v}=e;n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:f,data:(r=v==null?void 0:v.data)!==null&&r!==void 0?r:{},channel:(i=v==null?void 0:v.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},xform:te})}else throw new Le("You must provide either an email or phone number and a password");const{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(S(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:o,options:a}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:sr})}else if("phone"in e){const{phone:n,password:o,options:a}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:sr})}else throw new Le("You must provide either an email or phone number and a password");const{data:r,error:i}=t;return i?{data:{user:null,session:null},error:i}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new et}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(t){if(S(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Ue(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(t??"").split("/");try{const{data:n,error:o}=await k(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:te});if(await Fe(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new et}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:o})}catch(n){if(S(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:r,token:i,access_token:n,nonce:o}=e,a=await k(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:te}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new et}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(S(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,i,n,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await he(this.storage,this.storageKey));const{error:f}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new Le("You must provide either an email or phone number.")}catch(a){if(S(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await k(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:te});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(S(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,r,i;try{let n=null,o=null;return this.flowType==="pkce"&&([n,o]=await he(this.storage,this.storageKey)),await k(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:Gn})}catch(n){if(S(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new ee;const{error:i}=await k(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(S(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:n}=e,{error:o}=await k(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:i,options:n}=e,{data:o,error:a}=await k(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Le("You must provide either an email or phone number and a type")}catch(t){if(S(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ue(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Ze:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:se}):await this._useSession(async t=>{var r,i,n;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ee}:await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:se})})}catch(t){if(S(t))return bn(t)&&(await this._removeSession(),await Fe(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:n}=r;if(n)throw n;if(!i.session)throw new ee;const o=i.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await he(this.storage,this.storageKey));const{data:c,error:u}=await k(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:se});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(S(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ee;const t=Date.now()/1e3;let r=t,i=!0,n=null;const{payload:o}=rt(e.access_token);if(o.exp&&(r=o.exp,i=r<=t),i){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(S(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new ee;const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(S(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!W())throw new De("No browser detected.");if(e.error||e.error_description||e.error_code)throw new De(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Yt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new De("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Yt("No code detected.");const{data:z,error:q}=await this._exchangeCodeForSession(e.code);if(q)throw q;const F=new URL(window.location.href);return F.searchParams.delete("code"),window.history.replaceState(window.history.state,"",F.toString()),{data:{session:z.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:n,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!n||!a||!o||!c)throw new De("No session defined in URL");const u=Math.round(Date.now()/1e3),f=parseInt(a);let v=u+f;l&&(v=parseInt(l));const p=v-u;p*1e3<=ge&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${f}s`);const w=v-f;u-w>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",w,v,u):u-w<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",w,v,u);const{data:E,error:b}=await this._getUser(n);if(b)throw b;const L={provider_token:r,provider_refresh_token:i,access_token:n,expires_in:f,expires_at:v,refresh_token:o,token_type:c,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:L,redirectType:e.type},error:null}}catch(r){if(S(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ue(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:n}=t;if(n)return{error:n};const o=(r=i.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(wn(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Fe(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=$n(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:n},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await he(this.storage,this.storageKey,!0));try{return await k(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(S(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(S(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:i}=await this._useSession(async n=>{var o,a,l,c,u;const{data:f,error:v}=n;if(v)throw v;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await k(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(c=f.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return W()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(S(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,i;const{data:n,error:o}=t;if(o)throw o;return await k(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(S(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Rn(async i=>(i>0&&await xn(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await k(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:te})),(i,n)=>{const o=200*Math.pow(2,i);return n&&tt(n)&&Date.now()+o-r<ge})}catch(r){if(this._debug(t,"error",r),S(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),W()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Ue(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Ze;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Ze}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:n}=await this._callRefreshToken(r.refresh_token);n&&(console.error(n),tt(n)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",n),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new ee;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ke;const{data:n,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!n.session)throw new ee;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={session:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(i,"error",n),S(n)){const o={session:null,error:n};return tt(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(o),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await xr(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Fe(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&W()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ge);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/ge);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${ge}ms, refresh threshold is ${dt} ticks`),i<=dt&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Rr)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!W()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const i=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[n,o]=await he(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(r!=null&&r.queryParams){const n=new URLSearchParams(r.queryParams);i.push(n.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:n}=t;return n?{data:null,error:n}:await k(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(S(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:n,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await k(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(S(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:o,error:a}=await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(S(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:n}=t;return n?{data:null,error:n}:await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(S(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],i=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),n=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:i,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=rt(i.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((r=(t=i.user.factors)===null||t===void 0?void 0:t.filter(f=>f.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+_n>Date.now()))return r;const{data:i,error:n}=await k(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;if(!i.keys||i.keys.length===0)throw new Ae("JWKS is empty");if(this.jwks=i,this.jwks_cached_at=Date.now(),r=i.keys.find(o=>o.kid===e),!r)throw new Ae("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:p,error:w}=await this.getSession();if(w||!p.session)return{data:null,error:w};r=p.session.access_token}const{header:i,payload:n,signature:o,raw:{header:a,payload:l}}=rt(r);if(qn(n.exp),!i.kid||i.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:n,header:i,signature:o},error:null}}const c=Mn(i.alg),u=await this.fetchJwk(i.kid,t),f=await crypto.subtle.importKey("jwk",u,c,!0,["verify"]);if(!await crypto.subtle.verify(c,f,o,On(`${a}.${l}`)))throw new Ae("Invalid JWT signature");return{data:{claims:n,header:i,signature:o},error:null}}catch(r){if(S(r))return{data:null,error:r};throw r}}}$e.nextInstanceID=0;const io=$e;class no extends io{constructor(e){super(e)}}var oo=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};class ao{constructor(e,t,r){var i,n,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=hn(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:sn,realtime:on,auth:Object.assign(Object.assign({},nn),{storageKey:l}),global:rn},u=fn(r??{},c);this.storageKey=(i=u.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(n=u.global.headers)!==null&&n!==void 0?n:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=un(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Ei(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Zs(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Zi(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return oo(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,storageKey:n,flowType:o,lock:a,debug:l},c,u){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new no({url:this.authUrl,headers:Object.assign(Object.assign({},f),c),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,flowType:o,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Bi(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const lo=(s,e,t)=>new ao(s,e,t),co="https://qhetbddcmbljmirrkaac.supabase.co",uo="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFoZXRiZGRjbWJsam1pcnJrYWFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxMzQ2MzYsImV4cCI6MjA2MjcxMDYzNn0.R1xJDIQHl8G-t4uYDH8pDwlLd7pJCwqtWMvplaJxUmA",_=lo(co,uo);async function ho(){try{const{data:s,error:e}=await _.rpc("get_pg_version");return e?(console.error("Error connecting to Supabase:",e),!1):(console.log("Supabase connection established. PostgreSQL version:",s),!0)}catch(s){return console.error("Error initializing Supabase:",s),!1}}async function fo(){const s=["shifts","tasks","porter_assignments","shift_assigned_porters","supervisors","porters","buildings","departments","job_categories","job_category_defaults","designation_departments","settings"];try{for(const e of s){const{count:t,error:r}=await _.from(e).select("*",{count:"exact",head:!0});r?(console.error(`Error checking table ${e}:`,r),await go(e)):console.log(`Table ${e} exists, has ${t} rows`)}return!0}catch(e){return console.error("Error ensuring tables exist:",e),!1}}async function go(s){return console.warn(`Table ${s} doesn't exist or can't be accessed. Please create it through the Supabase dashboard.`),!1}const po="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let G=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s|=0));for(;s--;)e+=po[t[s]&63];return e};async function vo(s){try{return await Dt(s),{success:!0,message:"Settings saved successfully"}}catch(e){throw console.error("Error saving settings:",e),e}}async function mo(s){try{return await Ut(s),{success:!0,message:"Locations saved successfully"}}catch(e){throw console.error("Error saving locations:",e),e}}const St=lr("settings",()=>{const s=$([]),e=$([]),t=$({}),r=$([]),i=$([]),n=$([{id:"ae",name:"A+E",color:"#d63031"},{id:"ct",name:"CT",color:"#0984e3"},{id:"mri",name:"MRI",color:"#00b894"},{id:"amu",name:"AMU",color:"#6c5ce7"},{id:"pharmacy",name:"Pharmacy",color:"#fdcb6e"},{id:"meals",name:"Meals",color:"#e17055"}]),o=$({day:{start:"08:00",end:"16:00"},night:{start:"20:00",end:"04:00"}}),a=$(!1),l=$(null),c=$(!1);async function u(){a.value=!0,l.value=null,c.value=!1;try{return await f(),await p(),c.value=!0,console.log("Settings initialization complete"),!0}catch(d){return console.error("Error initializing settings:",d),l.value=d instanceof Error?d.message:"Failed to load settings",!1}finally{a.value=!1}}async function f(){try{try{const d=await Rt();return v(d),console.log("Settings loaded from database"),!0}catch(d){console.warn("Error loading settings from database, falling back to localStorage:",d);const g=localStorage.getItem("porterTrackSettings");if(g)try{const T=JSON.parse(g);return v(T),console.log("Settings loaded from localStorage"),!0}catch(T){console.warn("Error parsing localStorage settings, falling back to JSON file:",T)}const m=await fetch("/data/settings.json");if(!m.ok)throw new Error(`Failed to load settings: ${m.status} ${m.statusText}`);const y=await m.json();return v(y),!0}}catch(d){throw console.error("Error loading settings:",d),l.value=d instanceof Error?d.message:"Failed to load settings",d}}function v(d){d.supervisors&&(s.value=d.supervisors),d.porters&&(e.value=d.porters),d.jobCategories&&(t.value=d.jobCategories),d.jobCategoryDefaults&&(i.value=d.jobCategoryDefaults),d.shifts&&(o.value=d.shifts),d.designationDepartments&&(n.value=d.designationDepartments)}async function p(){try{try{const d=await Lt();return r.value=d.buildings,console.log("Location data loaded from database"),!0}catch(d){console.warn("Error loading locations from database, falling back to localStorage:",d);const g=localStorage.getItem("porterTrackLocations");if(g)try{const T=JSON.parse(g);return r.value=T.buildings,console.log("Location data loaded from localStorage"),!0}catch(T){console.warn("Error parsing localStorage locations, falling back to JSON file:",T)}const m=await fetch("/data/locations.json");if(!m.ok)throw new Error(`Failed to load location data: ${m.status} ${m.statusText}`);const y=await m.json();return r.value=y.buildings,!0}}catch(d){throw console.error("Error loading location data:",d),l.value=d instanceof Error?d.message:"Failed to load location data",d}}async function w(){try{const d={supervisors:s.value,porters:e.value,jobCategories:t.value,jobCategoryDefaults:i.value,shifts:o.value,designationDepartments:n.value};console.log("Saving settings:",d);try{const g=await vo(d);console.log("Settings saved via API:",g)}catch(g){console.warn("Could not save settings via API:",g);try{localStorage.setItem("porterTrackSettings",JSON.stringify(d)),console.log("Settings saved to localStorage as fallback")}catch(m){console.warn("Could not save to localStorage:",m),console.info("Changes are in memory only and will be lost on refresh")}}return!0}catch(d){return console.error("Error saving settings:",d),l.value=d instanceof Error?d.message:"Failed to save settings",!1}}async function E(){try{const d={buildings:r.value};console.log("Saving location data:",d);try{const g=await mo(d);console.log("Location data saved via API:",g)}catch(g){console.warn("Could not save location data via API:",g);try{localStorage.setItem("porterTrackLocations",JSON.stringify(d)),console.log("Location data saved to localStorage as fallback")}catch(m){console.warn("Could not save location data to localStorage:",m),console.info("Changes are in memory only and will be lost on refresh")}}return!0}catch(d){return console.error("Error saving location data:",d),l.value=d instanceof Error?d.message:"Failed to save location data",!1}}function b(d){return d.supervisors!==void 0&&(s.value=d.supervisors),d.porters!==void 0&&(e.value=d.porters),d.jobCategories!==void 0&&(t.value=d.jobCategories),d.jobCategoryDefaults!==void 0&&(i.value=d.jobCategoryDefaults),d.shifts!==void 0&&(o.value=d.shifts),d.designationDepartments!==void 0&&(n.value=d.designationDepartments),w(),!0}function L(d){return!d.trim()||s.value.includes(d)?!1:(s.value.push(d),b({supervisors:s.value}),!0)}function z(d,g){const m=s.value.indexOf(d);return m===-1||!g.trim()||g!==d&&s.value.includes(g)?!1:(s.value[m]=g,b({supervisors:s.value}),!0)}function q(d){const g=s.value.indexOf(d);return g===-1?!1:(s.value.splice(g,1),b({supervisors:s.value}),!0)}function F(d){return!d.trim()||e.value.includes(d)?!1:(e.value.push(d),b({porters:e.value}),!0)}function B(d,g){const m=e.value.indexOf(d);return m===-1||!g.trim()||g!==d&&e.value.includes(g)?!1:(e.value[m]=g,b({porters:e.value}),!0)}function ss(d){const g=e.value.indexOf(d);return g===-1?!1:(e.value.splice(g,1),b({porters:e.value}),!0)}function is(d){return!d.trim()||d in t.value?!1:(t.value[d]=[],b({jobCategories:t.value}),!0)}function ns(d,g){if(!g.trim()||g in t.value||!(d in t.value))return!1;const m=[...t.value[d]];return delete t.value[d],t.value[g]=m,b({jobCategories:t.value}),!0}function os(d){return d in t.value?(delete t.value[d],b({jobCategories:t.value}),!0):!1}function as(d,g){return!g.trim()||!(d in t.value)||t.value[d].includes(g)?!1:(t.value[d].push(g),b({jobCategories:t.value}),!0)}function ls(d,g,m){if(!m.trim()||!(d in t.value))return!1;const y=t.value[d].indexOf(g);return y===-1||m!==g&&t.value[d].includes(m)?!1:(t.value[d][y]=m,b({jobCategories:t.value}),!0)}function cs(d,g){if(!(d in t.value))return!1;const m=t.value[d].indexOf(g);return m===-1?!1:(t.value[d].splice(m,1),b({jobCategories:t.value}),!0)}function us(d){const g=r.value.find(m=>m.id===d);return g==null?void 0:g.name}function ds(d,g,m){const y=r.value.find(K=>K.id===d);if(!y)return;const T=y.departments.find(K=>K.id===g);return T==null?void 0:T.name}function hs(d){if(!d.trim()||r.value.some(y=>y.name===d))return!1;const g=d.toLowerCase().replace(/\s+/g,"-");if(r.value.some(y=>y.id===g))return!1;const m={id:g,name:d,departments:[]};return r.value.push(m),console.log("Building added:",m),E(),!0}function fs(d,g){if(!g.trim())return!1;const m=r.value.find(y=>y.id===d);return!m||r.value.some(y=>y.name===g&&y.id!==d)?!1:(m.name=g,console.log("Building updated:",m),E(),!0)}function gs(d){const g=r.value.findIndex(m=>m.id===d);return g===-1?!1:(r.value.splice(g,1),console.log("Building deleted:",d),E(),!0)}function Bt(d,g){if(!g.trim())return!1;const m=r.value.find(T=>T.id===d);if(!m||m.departments.some(T=>T.name===g))return!1;const y=g.toLowerCase().replace(/\s+/g,"-");return m.departments.some(T=>T.id===y)?!1:(m.departments.push({id:y,name:g}),console.log("Department added:",{buildingId:d,department:{id:y,name:g}}),E(),!0)}function Nt(d,g,m){if(!m.trim())return!1;const y=r.value.find(K=>K.id===d);if(!y)return!1;const T=y.departments.find(K=>K.id===g);return!T||y.departments.some(K=>K.name===m&&K.id!==g)?!1:(T.name=m,console.log("Department updated:",{buildingId:d,department:T}),E(),!0)}function qt(d,g){const m=r.value.find(T=>T.id===d);if(!m)return!1;const y=m.departments.findIndex(T=>T.id===g);return y===-1?!1:(m.departments.splice(y,1),console.log("Department deleted:",{buildingId:d,departmentId:g}),E(),!0)}function ps(d,g){return Bt(d,g)}function vs(d,g,m){return Nt(d,g,m)}function ms(d,g){return qt(d,g)}function _s(d,g){if(g){const m=i.value.find(y=>y.category===d&&y.itemType===g);if(m)return m}return i.value.find(m=>m.category===d&&!m.itemType)}function ys(d){let g=-1;return d.itemType?g=i.value.findIndex(m=>m.category===d.category&&m.itemType===d.itemType):g=i.value.findIndex(m=>m.category===d.category&&!m.itemType),g!==-1?i.value[g]=d:i.value.push(d),w(),!0}function ws(d,g){let m=-1;return g?m=i.value.findIndex(y=>y.category===d&&y.itemType===g):m=i.value.findIndex(y=>y.category===d&&!y.itemType),m===-1?!1:(i.value.splice(m,1),w(),!0)}function bs(d,g){if(!d.trim()||n.value.some(y=>y.name===d))return!1;const m=d.toLowerCase().replace(/\s+/g,"-");return n.value.some(y=>y.id===m)?!1:(n.value.push({id:m,name:d,color:g||"#"+Math.floor(Math.random()*16777215).toString(16)}),w(),!0)}function Ss(d,g,m){const y=n.value.find(T=>T.id===d);return!y||!g.trim()||n.value.some(T=>T.name===g&&T.id!==d)?!1:(y.name=g,m&&(y.color=m),w(),!0)}function ks(d){const g=n.value.findIndex(m=>m.id===d);return g===-1?!1:(n.value.splice(g,1),w(),!0)}function Es(d){return n.value.find(g=>g.id===d)}function Ts(d){return d.departments}return{supervisors:s,porters:e,jobCategories:t,buildings:r,jobCategoryDefaults:i,designationDepartments:n,shifts:o,isLoading:a,error:l,isInitialized:c,initialize:u,loadSettings:f,loadLocationData:p,updateSettings:b,saveSettingsToFile:w,saveLocationDataToFile:E,addSupervisor:L,updateSupervisor:z,deleteSupervisor:q,addPorter:F,updatePorter:B,deletePorter:ss,addCategory:is,updateCategory:ns,deleteCategory:os,addItemType:as,updateItemType:ls,deleteItemType:cs,addBuilding:hs,updateBuilding:fs,deleteBuilding:gs,addDepartment:Bt,updateDepartment:Nt,deleteDepartment:qt,addWard:ps,updateWard:vs,deleteWard:ms,getJobCategoryDefault:_s,setJobCategoryDefault:ys,deleteJobCategoryDefault:ws,addDesignationDepartment:bs,updateDesignationDepartment:Ss,deleteDesignationDepartment:ks,getDesignationDepartment:Es,getAllDepartments:Ts,getBuildingName:us,getLocationName:ds}});function Lr(s){const e=St(),{buildings:t}=e;if(s.fromLocation&&s.fromLocation.building&&s.fromLocation.locationId){const r=t.find(i=>i.id===s.fromLocation.building);if(r){const i=r.departments.find(n=>n.id===s.fromLocation.locationId);i&&(s.fromLocation.displayName=i.name)}}if(s.toLocation&&s.toLocation.building&&s.toLocation.locationId){const r=t.find(i=>i.id===s.toLocation.building);if(r){const i=r.departments.find(n=>n.id===s.toLocation.locationId);i&&(s.toLocation.displayName=i.name)}}return s}function _o(s){return s.map(e=>Lr(e))}function We(s){if(!s)return null;const e={id:s.id,date:s.date,type:s.type,supervisor:s.supervisor,startTime:s.start_time,endTime:s.end_time,isActive:s.is_active||!1,tasks:[],assignedPorters:[],porterAssignments:[]};if(s.tasks&&Array.isArray(s.tasks)){const t=s.tasks.map(r=>({id:r.id,receivedTime:r.received_time,allocatedTime:r.allocated_time,completedTime:r.completed_time,status:r.status,jobCategory:r.job_category,itemType:r.item_type,allocatedStaff:r.allocated_staff,fromLocation:{building:r.from_building,locationId:r.from_location_id,displayName:""},toLocation:{building:r.to_building,locationId:r.to_location_id,displayName:""}}));try{e.tasks=_o(t)}catch(r){console.warn("Could not populate location display names for tasks:",r),e.tasks=t}}return s.shift_assigned_porters&&Array.isArray(s.shift_assigned_porters)&&(e.assignedPorters=s.shift_assigned_porters.map(t=>t.porter_id)),s.porter_assignments&&Array.isArray(s.porter_assignments)&&(e.porterAssignments=s.porter_assignments.map(t=>({id:t.id,porterId:t.porter_id,departmentId:t.department_id,startTime:t.start_time,endTime:t.end_time,notes:t.notes}))),e}async function Dr(){try{console.log("Fetching current active shift from database...");const{data:s,error:e}=await _.from("shifts").select(`
        *,
        tasks(*),
        shift_assigned_porters(*),
        porter_assignments(*)
      `).eq("is_active",!0).maybeSingle();if(e)return console.error("Error fetching current shift:",e),null;if(s){console.log("Active shift found:",s.id);const t=We(s);return t!=null&&t.id&&sessionStorage.setItem("porter-track-current-shift-id",t.id),t}else return console.log("No active shift found in database"),sessionStorage.removeItem("porter-track-current-shift-id"),null}catch(s){return console.error("Unexpected error fetching current shift:",s),null}}async function Ur(){const{data:s,error:e}=await _.from("shifts").select(`
      *,
      tasks(*),
      shift_assigned_porters(*),
      porter_assignments(*)
    `).not("end_time","is",null).order("start_time",{ascending:!1});if(e)throw e;return s.map(We)}async function xe(s){const{data:e,error:t}=await _.from("shifts").select(`
      *,
      tasks(*),
      shift_assigned_porters(*),
      porter_assignments(*)
    `).eq("id",s).single();if(t)throw t;return We(e)}async function kt(s){const e={id:G(),date:s.date,type:s.type,supervisor:s.supervisor,start_time:s.startTime,end_time:null,is_active:!0},{data:t,error:r}=await _.from("shifts").insert(e).select("*").single();if(r)throw r;return{id:t.id,date:t.date,type:t.type,supervisor:t.supervisor,startTime:t.start_time,endTime:t.end_time,tasks:[]}}async function Fr(s,e){const{error:t}=await _.from("shifts").update({end_time:e,is_active:!1}).eq("id",s);if(t)throw t;return!0}async function Br(s){const{error:e}=await _.from("shifts").update({end_time:null,is_active:!0}).eq("id",s);if(e)throw e;return xe(s)}async function Nr(s){await _.from("tasks").delete().eq("shift_id",s),await _.from("porter_assignments").delete().eq("shift_id",s),await _.from("shift_assigned_porters").delete().eq("shift_id",s);const{error:e}=await _.from("shifts").delete().eq("id",s);if(e)throw e;return!0}async function qr(s,e){const t={id:G(),shift_id:s,porter_id:e},{error:r}=await _.from("shift_assigned_porters").insert(t);if(r)throw r;return!0}async function Mr(s,e){const{error:t}=await _.from("shift_assigned_porters").delete().eq("shift_id",s).eq("porter_id",e);if(t)throw t;return!0}function Et(s){const e={id:s.id,receivedTime:s.received_time,allocatedTime:s.allocated_time,completedTime:s.completed_time,status:s.status,jobCategory:s.job_category,itemType:s.item_type,allocatedStaff:s.allocated_staff,fromLocation:{building:s.from_building,locationId:s.from_location_id,displayName:""},toLocation:{building:s.to_building,locationId:s.to_location_id,displayName:""}};try{return Lr(e)}catch(t){return console.warn("Could not populate location display names:",t),e}}async function Jr(s,e){const t=new Date,r={id:G(),shift_id:s,received_time:e.receivedTime||t.toISOString(),allocated_time:e.allocatedTime||t.toISOString(),completed_time:e.completedTime||null,status:e.status||"Pending",job_category:e.jobCategory,item_type:e.itemType,allocated_staff:e.allocatedStaff||null,from_building:e.fromLocation.building,from_location_id:e.fromLocation.locationId,to_building:e.toLocation.building,to_location_id:e.toLocation.locationId},{data:i,error:n}=await _.from("tasks").insert(r).select("*").single();if(n)throw n;return Et(i)}async function Ne(s,e){const{data:t,error:r}=await _.from("tasks").select("*").eq("id",s).single();if(r)throw r;const i={};e.jobCategory!==void 0&&(i.job_category=e.jobCategory),e.itemType!==void 0&&(i.item_type=e.itemType),e.allocatedStaff!==void 0&&(i.allocated_staff=e.allocatedStaff),e.receivedTime!==void 0&&(i.received_time=e.receivedTime),e.allocatedTime!==void 0&&(i.allocated_time=e.allocatedTime),e.completedTime!==void 0&&(i.completed_time=e.completedTime),e.status!==void 0&&(i.status=e.status),e.fromLocation&&(i.from_building=e.fromLocation.building,i.from_location_id=e.fromLocation.locationId),e.toLocation&&(i.to_building=e.toLocation.building,i.to_location_id=e.toLocation.locationId);const{data:n,error:o}=await _.from("tasks").update(i).eq("id",s).select("*").single();if(o)throw o;return Et(n)}async function gt(s){const{error:e}=await _.from("tasks").delete().eq("id",s);if(e)throw e;return!0}function Tt(s){return{id:s.id,porterId:s.porter_id,departmentId:s.department_id,startTime:s.start_time,endTime:s.end_time||void 0,notes:s.notes||void 0}}function zr(s,e){return{id:"id"in s?s.id:G(),shift_id:e,porter_id:s.porterId,department_id:s.departmentId,start_time:s.startTime,end_time:s.endTime||null,notes:s.notes||null}}async function Hr(s,e){const t=zr(e,s),{data:r,error:i}=await _.from("porter_assignments").insert(t).select("*").single();if(i)throw i;return Tt(r)}async function Vr(s,e){const t={};e.departmentId!==void 0&&(t.department_id=e.departmentId),e.endTime!==void 0&&(t.end_time=e.endTime),e.notes!==void 0&&(t.notes=e.notes);const{data:r,error:i}=await _.from("porter_assignments").update(t).eq("id",s).select("*").single();if(i)throw i;return Tt(r)}async function Gr(s){const{error:e}=await _.from("porter_assignments").delete().eq("id",s);if(e)throw e;return!0}function At(s,e){const t={};return e.forEach(r=>{t[r.building_id]||(t[r.building_id]=[]),t[r.building_id].push(r)}),s.map(r=>({id:r.id,name:r.name,departments:(t[r.id]||[]).map(i=>({id:i.id,name:i.name}))}))}function Pt(s){const e={};return s.forEach(t=>{e[t.category]||(e[t.category]=[]),t.item_type&&e[t.category].push(t.item_type)}),e}function Ot(s){return s.map(e=>({category:e.category,itemType:e.item_type||void 0,fromBuildingId:e.from_building_id||void 0,fromLocationId:e.from_location_id||void 0,toBuildingId:e.to_building_id||void 0,toLocationId:e.to_location_id||void 0}))}function jt(s){return s.map(e=>({id:e.id,name:e.name,color:e.color}))}function $t(s){return{id:s.id,name:s.name}}function It(s,e){return{id:s.id,building_id:e,name:s.name}}function qe(s,e){return{id:G(),category:s,item_type:e||null}}function Ct(s){return{id:G(),category:s.category,item_type:s.itemType||null,from_building_id:s.fromBuildingId||null,from_location_id:s.fromLocationId||null,to_building_id:s.toBuildingId||null,to_location_id:s.toLocationId||null}}function xt(s){return{id:s.id,name:s.name,color:s.color}}async function Rt(){try{const{data:s,error:e}=await _.from("supervisors").select("name").order("name");if(e)throw e;const{data:t,error:r}=await _.from("porters").select("name").order("name");if(r)throw r;const{data:i,error:n}=await _.from("job_categories").select("*");if(n)throw n;const{data:o,error:a}=await _.from("job_category_defaults").select("*");if(a)throw a;const{data:l,error:c}=await _.from("designation_departments").select("*");if(c)throw c;const{data:u,error:f}=await _.from("settings").select("key, value").in("key",["shift_day_start","shift_day_end","shift_night_start","shift_night_end"]);if(f)throw f;const v={day:{start:"08:00",end:"16:00"},night:{start:"20:00",end:"04:00"}};return u&&u.length>0&&u.forEach(p=>{p.key==="shift_day_start"&&(v.day.start=p.value),p.key==="shift_day_end"&&(v.day.end=p.value),p.key==="shift_night_start"&&(v.night.start=p.value),p.key==="shift_night_end"&&(v.night.end=p.value)}),{supervisors:s.map(p=>p.name),porters:t.map(p=>p.name),jobCategories:Pt(i),jobCategoryDefaults:Ot(o),designationDepartments:jt(l),shifts:v}}catch(s){throw console.error("Error fetching settings from Supabase:",s),s}}async function Lt(){try{const{data:s,error:e}=await _.from("buildings").select("*").order("name");if(e)throw e;const{data:t,error:r}=await _.from("departments").select("*").order("name");if(r)throw r;return{buildings:At(s,t)}}catch(s){throw console.error("Error fetching locations from Supabase:",s),s}}async function Dt(s){try{const e=s.supervisors.map(a=>({name:a}));if(await _.from("supervisors").delete().gt("id",0),e.length>0){const{error:a}=await _.from("supervisors").insert(e);if(a)throw a}const t=s.porters.map(a=>({name:a}));if(await _.from("porters").delete().gt("id",0),t.length>0){const{error:a}=await _.from("porters").insert(t);if(a)throw a}const r=[];if(Object.entries(s.jobCategories).forEach(([a,l])=>{r.push(qe(a)),l.forEach(c=>{r.push(qe(a,c))})}),await _.from("job_categories").delete().gt("id",0),r.length>0){const{error:a}=await _.from("job_categories").insert(r);if(a)throw a}const i=s.jobCategoryDefaults.map(Ct);if(await _.from("job_category_defaults").delete().gt("id",0),i.length>0){const{error:a}=await _.from("job_category_defaults").insert(i);if(a)throw a}const n=s.designationDepartments.map(xt);if(await _.from("designation_departments").delete().gt("id",0),n.length>0){const{error:a}=await _.from("designation_departments").insert(n);if(a)throw a}const o=[{key:"shift_day_start",value:s.shifts.day.start},{key:"shift_day_end",value:s.shifts.day.end},{key:"shift_night_start",value:s.shifts.night.start},{key:"shift_night_end",value:s.shifts.night.end}];for(const a of o){const{error:l}=await _.from("settings").upsert({key:a.key,value:a.value},{onConflict:"key"});if(l)throw l}return!0}catch(e){throw console.error("Error saving settings to Supabase:",e),e}}async function Ut(s){try{const e=s.buildings.map($t);if(await _.from("buildings").delete().gt("id",0),e.length>0){const{error:r}=await _.from("buildings").insert(e);if(r)throw r}const t=[];if(s.buildings.forEach(r=>{r.departments.forEach(i=>{t.push(It(i,r.id))})}),await _.from("departments").delete().gt("id",0),t.length>0){const{error:r}=await _.from("departments").insert(t);if(r)throw r}return!0}catch(e){throw console.error("Error saving locations to Supabase:",e),e}}const Kr=Object.freeze(Object.defineProperty({__proto__:null,getLocations:Lt,getSettings:Rt,saveLocations:Ut,saveSettings:Dt,transformBuildingToSupabase:$t,transformBuildingsFromSupabase:At,transformDepartmentToSupabase:It,transformDesignationDepartmentToSupabase:xt,transformDesignationDepartmentsFromSupabase:jt,transformJobCategoriesFromSupabase:Pt,transformJobCategoryDefaultToSupabase:Ct,transformJobCategoryDefaultsFromSupabase:Ot,transformJobCategoryToSupabase:qe},Symbol.toStringTag,{value:"Module"}));async function Wr(){try{const{count:s,error:e}=await _.from("supervisors").select("*",{count:"exact",head:!0});if(e)return console.error("Error checking supervisors table:",e),!0;const{count:t,error:r}=await _.from("buildings").select("*",{count:"exact",head:!0});if(r)return console.error("Error checking buildings table:",r),!0;const{count:i,error:n}=await _.from("job_categories").select("*",{count:"exact",head:!0});return n?(console.error("Error checking job_categories table:",n),!0):s===0||t===0||i===0}catch(s){return console.error("Error checking if database needs migration:",s),!0}}async function Qr(){try{console.log("Initializing Supabase database connection...");const{data:s,error:e}=await _.from("settings").select("*").limit(1);return e?(console.error("Error connecting to Supabase:",e),!1):(console.log("Supabase database connection initialized successfully"),!0)}catch(s){return console.error("Failed to initialize database:",s),!1}}async function yo(){try{console.log("Adding job category default locations...");const{data:s,error:e}=await _.from("job_category_defaults").select("*").eq("category","Specimen Delivery");if(e)return console.error("Error checking for existing defaults:",e),!1;if(s&&s.length>0)return console.log("Default location for Specimen Delivery already exists"),!0;const t="new-fountain-house",r="pathology",{data:i}=await _.from("buildings").select("id").eq("id",t),{data:n}=await _.from("departments").select("id, building_id").eq("id",r);if(!i||i.length===0)return console.error(`Building with ID "${t}" not found`),!1;if(!n||n.length===0)return console.error(`Department with ID "${r}" not found`),!1;const o=n[0];o.building_id!==t&&console.warn(`Department "${r}" exists but is in building "${o.building_id}", not "${t}" as expected`);const{error:a}=await _.from("job_category_defaults").insert([{id:G(),category:"Specimen Delivery",item_type:null,from_building_id:null,from_location_id:null,to_building_id:"new-fountain-house",to_location_id:"pathology"}]);return a?(console.error("Error adding job category defaults:",a),!1):(console.log("Successfully added job category default locations"),!0)}catch(s){return console.error("Error adding job category defaults:",s),!1}}async function Yr(){try{if(console.log("Checking if database needs seeding..."),!await Wr())return console.log("Database already has data, skipping seed"),!0;console.log("Database is empty, seeding from local data...");let e=await wo();return e||(e=await bo()),e?(console.log("Database seeded successfully"),!0):(console.error("Failed to seed database from any source"),!1)}catch(s){return console.error("Error seeding database:",s),!1}}async function wo(){try{console.log("Attempting to seed database from localStorage...");const s=localStorage.getItem("porterTrackSettings"),e=localStorage.getItem("porterTrackLocations");if(!s||!e)return console.log("No complete data found in localStorage"),!1;const t=JSON.parse(s),r=JSON.parse(e);return await R(()=>Promise.resolve().then(()=>Kr),void 0).then(i=>Promise.all([i.saveSettings(t),i.saveLocations(r)])),console.log("Successfully seeded database from localStorage"),!0}catch(s){return console.error("Error seeding from localStorage:",s),!1}}async function bo(){try{console.log("Attempting to seed database from JSON files...");const s=await fetch("/data/settings.json"),e=await fetch("/data/locations.json");if(!s.ok||!e.ok)return console.error("Failed to fetch JSON files"),!1;const t=await s.json(),r=await e.json();return await R(()=>Promise.resolve().then(()=>Kr),void 0).then(i=>Promise.all([i.saveSettings(t),i.saveLocations(r)])),console.log("Successfully seeded database from JSON files"),!0}catch(s){return console.error("Error seeding from JSON files:",s),!1}}const So=Object.freeze(Object.defineProperty({__proto__:null,addJobCategoryDefaults:yo,addPorterAssignment:Hr,addPorterToShift:qr,createShift:kt,createTask:Jr,deletePorterAssignment:Gr,deleteShift:Nr,deleteTask:gt,endShift:Fr,getArchivedShifts:Ur,getCurrentShift:Dr,getLocations:Lt,getSettings:Rt,getShift:xe,initializeDatabase:Qr,removePorterFromShift:Mr,reopenShift:Br,saveLocations:Ut,saveSettings:Dt,seedDatabase:Yr,transformBuildingToSupabase:$t,transformBuildingsFromSupabase:At,transformDepartmentToSupabase:It,transformDesignationDepartmentToSupabase:xt,transformDesignationDepartmentsFromSupabase:jt,transformJobCategoriesFromSupabase:Pt,transformJobCategoryDefaultToSupabase:Ct,transformJobCategoryDefaultsFromSupabase:Ot,transformJobCategoryToSupabase:qe,transformPorterAssignmentFromSupabase:Tt,transformPorterAssignmentToSupabase:zr,transformShiftFromSupabase:We,transformTaskFromSupabase:Et,updatePorterAssignment:Vr,updateTask:Ne},Symbol.toStringTag,{value:"Module"}));async function ko(){je.value=!0,it.value=null;try{return nt.value=!1,await Xr(),await Zr(),nt.value=!0,console.log("Shift data loaded successfully, isShiftActive:",!!h.value),!0}catch(s){return console.error("Error loading shift data:",s),it.value=s instanceof Error?s.message:"Failed to load shift data",!1}finally{je.value=!1}}async function Xr(){try{const s=sessionStorage.getItem(Y);let e=0,t=!1;if(s){console.log("Found shift ID in session storage, attempting to load shift:",s),e++;try{const i=await xe(s);i?i.endTime?(console.log("Session contains an archived shift, will check for newer active shifts"),sessionStorage.removeItem(Y)):(h.value=Ee(i),console.log("Loaded active current shift from database using session ID:",i.id),console.log("Current shift object:",JSON.stringify(h.value)),t=!0):(console.warn("Shift ID from session not found in database:",s),sessionStorage.removeItem(Y))}catch(i){console.warn("Error loading shift from database using session ID, checking active shifts:",i)}}if(!t){e++;try{console.log("Checking database for any active shifts...");const i=await Dr();i?(h.value=Ee(i),i.id&&(sessionStorage.setItem(Y,i.id),console.log("Set session shift ID to:",i.id)),console.log("Loaded current shift from database:",i.id),console.log("Current shift object details:",JSON.stringify({id:i.id,date:i.date,endTime:i.endTime,type:i.type})),t=!0):(console.log("No active shifts found in database"),sessionStorage.removeItem(Y))}catch(i){console.warn("Error loading current shift from database, falling back to localStorage:",i)}}const r=localStorage.getItem(vt);if(r)try{const i=JSON.parse(r);return h.value=Ee(i),i.id&&sessionStorage.setItem(Y,i.id),console.log("Loaded current shift from localStorage:",i),!0}catch(i){console.error("Error parsing stored shift:",i)}return console.log("No current shift found in database or localStorage"),h.value=null,sessionStorage.removeItem(Y),!0}catch(s){return console.error("Error loading current shift:",s),h.value=null,!1}}async function Zr(){try{try{const s=await Ur();return j.value=s.filter(e=>e!==null),console.log("Loaded archived shifts from database:",s.length),!0}catch(s){console.warn("Error loading archived shifts from database, falling back to localStorage:",s);const e=localStorage.getItem(ur);if(e)try{const t=JSON.parse(e);return j.value=t,console.log("Loaded archived shifts from localStorage:",t.length),!0}catch(t){console.error("Error parsing stored archived shifts:",t)}return console.log("No archived shifts found in database or localStorage"),j.value=[],!0}}catch(s){return console.error("Error loading archived shifts:",s),!1}}async function Eo(s){const e=j.value.find(t=>t.id===s);if(e)return e;if(h.value&&h.value.id===s)return h.value;je.value=!0;try{const t=await xe(s);return t?Ee(t):null}catch(t){console.error(`Error loading shift ${s} from database:`,t);try{const r=await fetch(`/data/shifts/${s}.json`);if(!r.ok){if(r.status===404)return null;throw new Error(`Failed to load shift: ${r.status} ${r.statusText}`)}const i=await r.json();return Ee(i)}catch(r){return console.error(`Error loading shift ${s} from file:`,r),null}}finally{je.value=!1}}async function To(s,e){if(h.value)throw new Error("Cannot start a new shift while one is already active");const t=new Date,r=G(),i={id:r,date:t.toISOString().split("T")[0],type:s,supervisor:e,startTime:t.toISOString()},n={id:r,date:t.toISOString().split("T")[0],type:s,supervisor:e,startTime:t.toISOString(),tasks:[],assignedPorters:[],porterAssignments:[]};let o=!1;try{const l={...await kt(i),assignedPorters:[],porterAssignments:[],tasks:[]};return h.value=l,o=!0,O(),console.log("Shift started:",h.value),h.value}catch(a){return console.error("Error starting shift in database:",a),h.value=n,O(),localStorage.setItem("shift-"+r+"-local-only","true"),console.log("Shift started locally only (not in database):",n),n}}async function Ao(){if(!h.value)throw new Error("No active shift to end");const e=new Date().toISOString();try{if(await Fr(h.value.id,e),h.value){h.value.endTime=e;const r={...h.value};j.value.unshift(r)}try{Q()}catch(r){console.error("Error saving archived shifts to localStorage:",r)}console.log("Shift ended:",h.value);const t=h.value;return h.value=null,zt(),window.dispatchEvent(new CustomEvent("shift-ended")),!0}catch(t){if(console.error("Error ending shift in database:",t),h.value){h.value.endTime=e;const r={...h.value};j.value.unshift(r)}try{Q()}catch(r){console.error("Error saving archived shifts to localStorage:",r)}return console.log("Shift ended locally:",h.value),h.value=null,zt(),window.dispatchEvent(new CustomEvent("shift-ended")),!0}}async function Po(s){if(!h.value)throw new Error("No active shift to add porter to");if(h.value.assignedPorters||(h.value.assignedPorters=[]),h.value.assignedPorters.includes(s))return console.warn(`Porter ${s} is already assigned to this shift`),!1;try{return await qr(h.value.id,s),h.value.assignedPorters.push(s),O(),console.log(`Porter ${s} added to shift`),!0}catch(e){return console.error("Error adding porter to shift in database:",e),h.value.assignedPorters.push(s),O(),console.log(`Porter ${s} added to shift locally`),!0}}async function Oo(s){if(!h.value||!h.value.assignedPorters)throw new Error("No active shift or no assigned porters");const e=h.value.assignedPorters.indexOf(s);if(e===-1)return console.warn(`Porter ${s} is not assigned to this shift`),!1;try{return await Mr(h.value.id,s),h.value.assignedPorters.splice(e,1),O(),console.log(`Porter ${s} removed from shift`),!0}catch(t){return console.error("Error removing porter from shift in database:",t),h.value.assignedPorters.splice(e,1),O(),console.log(`Porter ${s} removed from shift locally`),!0}}async function jo(s){const e=j.value.findIndex(r=>r.id===s);if(e===-1)throw new Error(`Shift with ID ${s} not found`);if(h.value)throw new Error("Cannot reopen a shift while another is active. Please end the current shift first.");const t=JSON.parse(JSON.stringify(j.value[e]));try{const r=await Br(s);if(!r)throw new Error(`Failed to reopen shift with ID ${s}`);h.value=r,j.value.splice(e,1);try{O(),Q(),console.log("Shift reopened and localStorage updated:",r)}catch(i){console.error("Error updating localStorage after reopening shift:",i)}return r}catch(r){console.error("Error reopening shift in database:",r),delete t.endTime,h.value=t,j.value.splice(e,1);try{O(),Q(),console.log("Shift reopened locally and localStorage updated:",t)}catch(i){console.error("Error updating localStorage after reopening shift:",i)}return t}}async function $o(s){const e=j.value.findIndex(t=>t.id===s);if(e===-1)throw new Error(`Shift with ID ${s} not found`);try{await Nr(s),j.value.splice(e,1);try{Q(),console.log("Shift deleted and localStorage updated:",s)}catch(t){console.error("Error updating localStorage after shift deletion:",t)}return!0}catch(t){console.error("Error deleting shift from database:",t),j.value.splice(e,1);try{Q(),console.log("Shift deleted locally and localStorage updated:",s)}catch(r){console.error("Error updating localStorage after shift deletion:",r)}return!0}}async function Io(s){if(!h.value)throw new Error("Cannot create task without an active shift");const e=new Date,t=h.value.id,r=localStorage.getItem("shift-"+t+"-local-only")==="true",i={receivedTime:s.receivedTime||e.toISOString(),allocatedTime:s.allocatedTime||e.toISOString(),status:s.status||"Pending",...s};if(r){console.log("Shift exists only locally, creating task locally without database attempt");const n={id:G(),...i};return h.value.tasks.unshift(n),O(),Z(),console.log("Task created locally (local-only shift):",n),n}try{await Co();const n=await Jr(h.value.id,i);return h.value.tasks.unshift(n),O(),Z(),console.log("Task created:",n),n}catch(n){console.error("Error creating task in database:",n);const o={id:G(),...i};return h.value.tasks.unshift(o),O(),Z(),localStorage.setItem("shift-"+t+"-local-only","true"),console.log("Task created locally:",o),o}}async function Co(){if(h.value)try{if(!await xe(h.value.id)){console.log("Shift not found in database, attempting to recreate it");const e={id:h.value.id,date:h.value.date,type:h.value.type,supervisor:h.value.supervisor,startTime:h.value.startTime};await kt(e),console.log("Shift recreated in database")}}catch(s){throw console.error("Error checking/recreating shift in database:",s),s}}async function xo(s,e){if(!h.value)throw new Error("No active shift");const t=h.value.tasks.find(i=>i.id===s);if(!t)throw new Error(`Task with ID ${s} not found`);const r=new Date;t.status=e,e==="Completed"&&(t.completedTime=r.toISOString());try{return await Ne(s,{status:e,completedTime:e==="Completed"?r.toISOString():void 0}),O(),Z(),console.log("Task updated:",t),t}catch(i){return console.error("Error updating task in database:",i),O(),Z(),console.log("Task updated locally:",t),t}}async function Ro(s,e){if(h.value){const t=h.value.tasks.findIndex(r=>r.id===s);if(t!==-1)try{const r=await Ne(s,e);return h.value.tasks[t]=r,O(),Z(),console.log("Task updated in database:",r),r}catch(r){console.error("Error updating task in database:",r);const i={...h.value.tasks[t],...e,id:s};return h.value.tasks[t]=i,O(),Z(),console.log("Task updated locally:",i),i}}for(let t=0;t<j.value.length;t++){const r=j.value[t],i=r.tasks.findIndex(n=>n.id===s);if(i!==-1)try{const n=await Ne(s,e);return r.tasks[i]=n,Q(),console.log("Task updated in archived shift in database:",n),n}catch(n){console.error("Error updating task in database:",n);const o={...r.tasks[i],...e,id:s};return r.tasks[i]=o,Q(),console.log("Task updated in archived shift locally:",o),o}}throw new Error(`Task with ID ${s} not found in any shift`)}async function Lo(s){if(h.value){const e=h.value.tasks.findIndex(t=>t.id===s);if(e!==-1)try{return await gt(s),h.value.tasks.splice(e,1),O(),Z(),console.log("Task deleted from current shift:",s),!0}catch(t){return console.error("Error deleting task from database:",t),h.value.tasks.splice(e,1),O(),Z(),console.log("Task deleted from current shift locally:",s),!0}}for(let e=0;e<j.value.length;e++){const t=j.value[e],r=t.tasks.findIndex(i=>i.id===s);if(r!==-1)try{return await gt(s),t.tasks.splice(r,1),Q(),console.log("Task deleted from archived shift:",s),!0}catch(i){return console.error("Error deleting task from database:",i),t.tasks.splice(r,1),Q(),console.log("Task deleted from archived shift locally:",s),!0}}throw new Error(`Task with ID ${s} not found in any shift`)}function Do(s){if(h.value){const e=h.value.tasks.find(t=>t.id===s);if(e)return e}if(j.value.length>0)for(const e of j.value){const t=e.tasks.find(r=>r.id===s);if(t)return t}return null}async function Uo(s){if(!h.value)throw new Error("Cannot create assignment without an active shift");if(!h.value.assignedPorters||!h.value.assignedPorters.includes(s.porterId))throw new Error(`Porter ${s.porterId} is not assigned to this shift`);try{const e=await Hr(h.value.id,s);return h.value.porterAssignments||(h.value.porterAssignments=[]),h.value.porterAssignments.push(e),O(),console.log("Porter assignment created:",e),e}catch(e){console.error("Error creating porter assignment in database:",e);const t={id:G(),porterId:s.porterId,departmentId:s.departmentId,startTime:s.startTime,endTime:s.endTime,notes:s.notes};return h.value.porterAssignments||(h.value.porterAssignments=[]),h.value.porterAssignments.push(t),O(),console.log("Porter assignment created locally:",t),t}}async function Fo(s,e){if(!h.value||!h.value.porterAssignments)throw new Error("No active shift or no porter assignments");const t=h.value.porterAssignments.findIndex(r=>r.id===s);if(t===-1)throw new Error(`Assignment with ID ${s} not found`);try{const r=await Vr(s,e);return h.value.porterAssignments[t]=r,O(),console.log("Porter assignment updated:",r),r}catch(r){console.error("Error updating porter assignment in database:",r);const n={...h.value.porterAssignments[t],...e};return h.value.porterAssignments[t]=n,O(),console.log("Porter assignment updated locally:",n),n}}async function Bo(s){if(!h.value||!h.value.porterAssignments)throw new Error("No active shift or no porter assignments");const e=h.value.porterAssignments.findIndex(t=>t.id===s);if(e===-1)throw new Error(`Assignment with ID ${s} not found`);try{return await Gr(s),h.value.porterAssignments.splice(e,1),O(),console.log("Porter assignment deleted:",s),!0}catch(t){return console.error("Error deleting porter assignment from database:",t),h.value.porterAssignments.splice(e,1),O(),console.log("Porter assignment deleted locally:",s),!0}}function No(){if(!h.value||!h.value.porterAssignments)return[];const s=new Date().toISOString();return h.value.porterAssignments.filter(e=>{const t=e.startTime<=s,r=!e.endTime||e.endTime>s;return t&&r})}function qo(s){if(!h.value||!h.value.porterAssignments)return[];const e=new Date().toISOString();return h.value.porterAssignments.filter(t=>{const r=t.porterId===s,i=t.startTime<=e,n=!t.endTime||t.endTime>e;return r&&i&&n})}function Mo(s){if(!h.value||!h.value.porterAssignments)return[];const e=new Date().toISOString();return h.value.porterAssignments.filter(t=>{const r=t.departmentId===s,i=t.startTime<=e,n=!t.endTime||t.endTime>e;return r&&i&&n})}const Ft=lr("shift",()=>({currentShift:h,archivedShifts:j,isLoading:je,error:it,isLoaded:nt,isShiftActive:qs,pendingTasks:Ms,completedTasks:Js,porterAssignments:zs,currentPorterAssignments:Hs,loadShiftData:ko,loadCurrentShift:Xr,loadArchivedShifts:Zr,getShift:Eo,startShift:To,endShift:Ao,addPorterToShift:Po,removePorterFromShift:Oo,reopenShift:jo,deleteShift:$o,createTask:Io,updateTaskStatus:xo,updateTask:Ro,deleteTask:Lo,getTask:Do,addPorterAssignment:Uo,updatePorterAssignment:Fo,deletePorterAssignment:Bo,getCurrentPorterAssignments:No,getPorterActiveAssignments:qo,getDepartmentActiveAssignments:Mo})),or={};async function es(){try{console.log("Running migration to add active flag to shifts table...");const s=or.readFileSync(or.join(process.cwd(),"supabase/migration-add-active-flag.sql"),"utf8"),{error:e}=await _.rpc("pg_execute_sql",{sql:s});if(e){console.error("Error running migration:",e),console.log("Attempting to run statements individually...");const i=s.split(";").map(n=>n.trim()).filter(n=>n.length>0);for(const n of i){console.log(`Executing: ${n.substring(0,50)}...`);const{error:o}=await _.rpc("pg_execute_sql",{sql:n});o?console.error(`Error executing statement: ${o.message}`):console.log("Statement executed successfully")}}else console.log("Migration completed successfully");const{data:t,error:r}=await _.from("shifts").select("id, is_active").limit(5);r?console.error("Error verifying migration:",r):console.log("Verified migration - sample shifts data:",t)}catch(s){console.error("Unexpected error during migration:",s)}}require.main===module&&es().then(()=>{console.log("Migration script completed"),process.exit(0)}).catch(s=>{console.error("Migration failed:",s),process.exit(1)});async function Jo(){try{if(console.log("Initializing application..."),!await ho())return console.error("Failed to initialize Supabase connection"),!1;await fo()||console.warn("Some tables may not exist. Application might not function correctly.");try{const{data:i,error:n}=await _.from("shifts").select("is_active").limit(1);n?(console.log("The is_active column appears to be missing, running migration..."),await es()):console.log("Active flag column already exists, skipping migration")}catch(i){console.warn("Error checking/running active flag migration:",i)}if(!await Qr())return console.error("Failed to initialize database connection"),!1;await Wr()?(console.log("Database appears empty. Attempting to seed data..."),await Yr()?console.log("Database seeded successfully!"):console.warn("Database seeding may have failed. App will use fallback data sources.")):console.log("Database already contains data, no need to seed.");try{const{addJobCategoryDefaults:i}=await R(async()=>{const{addJobCategoryDefaults:n}=await Promise.resolve().then(()=>So);return{addJobCategoryDefaults:n}},void 0);await i()}catch(i){console.warn("Error adding job category defaults:",i)}return console.log("Application initialized successfully"),!0}catch(s){return console.error("Error during application initialization:",s),!1}}const zo=5*60*1e3;class Ho{constructor(){ue(this,"cache",new Map)}get(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp>zo?(this.delete(e),null):t.data:null}set(e,t){this.cache.set(e,{data:t,timestamp:Date.now(),key:e})}delete(e){this.cache.delete(e)}clearByPrefix(e){for(const[t]of this.cache)t.startsWith(e)&&this.cache.delete(t)}clear(){this.cache.clear()}}const Vo=new Ho;function Go(){Vo.clear()}function ve(){return navigator.onLine}function ts(s){const e=()=>s(!0),t=()=>s(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}function Ko(s){return s.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}function Na(s){return s.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1})}function qa(s,e){if(!s||!e)return"--";const t=typeof s=="string"?new Date(s):s,i=(typeof e=="string"?new Date(e):e).getTime()-t.getTime();if(i<0)return"--";const n=Math.floor(i/(1e3*60*60)),o=Math.floor(i%(1e3*60*60)/(1e3*60));return n===0?`${o}m`:o===0?`${n}h`:`${n}h ${o}m`}const Wo={class:"header"},Qo={class:"header-left"},Yo={class:"nav-icons"},Xo={key:0,class:"page-title"},Zo={key:1,class:"page-title"},ea={key:2,class:"page-title"},ta={key:3,class:"page-title"},ra={key:4,class:"page-title"},sa={key:5,class:"page-title"},ia={key:6,class:"page-title"},na={class:"header-right"},oa={key:0,class:"badge-count","aria-label":"{{ pendingTasksCount }} pending tasks"},aa=pt({__name:"Header",props:{taskId:{}},setup(s){const e=Mt("route"),t=Mt("router"),r=Ft(),i=r.currentShift,n=V(()=>r.isShiftActive),o=V(()=>(e==null?void 0:e.path)||"/"),a=V(()=>o.value==="/tasks"&&n.value?!1:o.value!=="/"),l=V(()=>{if(!i)return"Current Shift";const v=new Date(i.date),p=Ko(v);return`${i.type} Shift ${p}`}),c=V(()=>r.currentShift?r.currentShift.tasks.filter(v=>v.status==="Pending").length:0),u=()=>{t&&(o.value==="/tasks/pending"||o.value==="/tasks/completed"?t.push("/tasks"):o.value.startsWith("/archive/")?t.push("/archive"):o.value==="/tasks/form"?t.back():t.push("/"))},f=v=>{t&&t.push(v)};return(v,p)=>(C(),x("header",Wo,[A("div",Qo,[a.value?(C(),x("button",{key:0,class:"back-button",onClick:u,"aria-label":"Go back"},p[4]||(p[4]=[A("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[A("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1)]))):pe("",!0),A("nav",Yo,[A("button",{class:"nav-button",onClick:p[0]||(p[0]=w=>f("/")),"aria-label":"Home"},p[5]||(p[5]=[A("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[A("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),A("polyline",{points:"9 22 9 12 15 12 15 22"})],-1)])),A("button",{class:st(["nav-button",{active:o.value==="/archive"}]),onClick:p[1]||(p[1]=w=>f("/archive")),"aria-label":"Archive"},p[6]||(p[6]=[A("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[A("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),A("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})],-1)]),2),A("button",{class:st(["nav-button",{active:o.value==="/settings"}]),onClick:p[2]||(p[2]=w=>f("/settings")),"aria-label":"Settings"},p[7]||(p[7]=[A("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[A("circle",{cx:"12",cy:"12",r:"3"}),A("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})],-1)]),2)])]),o.value==="/tasks"?(C(),x("h1",Xo,me(l.value),1)):o.value==="/tasks/pending"?(C(),x("h1",Zo,"Pending Tasks")):o.value==="/tasks/completed"?(C(),x("h1",ea,"Completed Tasks")):o.value==="/archive"?(C(),x("h1",ta,"Shift Archive")):o.value.startsWith("/archive/")?(C(),x("h1",ra,"Shift Details")):o.value==="/settings"?(C(),x("h1",sa,"Settings")):o.value==="/tasks/form"?(C(),x("h1",ia,me(v.taskId?"Edit Task":"New Task"),1)):pe("",!0),A("div",na,[Os(v.$slots,"network-status",{},void 0),n.value?(C(),x("button",{key:0,class:"nav-button tasks-button active",onClick:p[3]||(p[3]=w=>f("/tasks")),"aria-label":"Tasks"},[p[8]||(p[8]=A("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[A("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),A("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"}),A("path",{d:"M9 14l2 2 4-4"})],-1)),c.value>0?(C(),x("span",oa,me(c.value),1)):pe("",!0)])):pe("",!0)])]))}}),rs=(s,e)=>{const t=s.__vccOpts||s;for(const[r,i]of e)t[r]=i;return t},la=rs(aa,[["__scopeId","data-v-05f38c22"]]),ar="porter-track-sync-queue",ca=3,ua=6e4;class da{constructor(){ue(this,"operations",[]);ue(this,"isProcessing",!1);ue(this,"syncInterval",null);ue(this,"networkListenerRemover",null);this.loadFromStorage(),this.networkListenerRemover=ts(e=>{e&&(console.log("Network is back online, processing sync queue"),this.processQueue())}),this.startAutoSync()}startAutoSync(){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=window.setInterval(()=>{ve()&&this.operations.some(e=>e.status==="pending")&&(console.log("Auto-sync: processing queue"),this.processQueue())},ua)}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null)}loadFromStorage(){try{const e=localStorage.getItem(ar);e&&(this.operations=JSON.parse(e),console.log(`Loaded ${this.operations.length} operations from sync queue`))}catch(e){console.error("Failed to load sync queue from storage:",e),this.operations=[]}}saveToStorage(){try{localStorage.setItem(ar,JSON.stringify(this.operations))}catch(e){console.error("Failed to save sync queue to storage:",e)}}add(e){const t={...e,id:ha(),timestamp:Date.now(),status:"pending",retries:0};return this.operations.push(t),this.saveToStorage(),ve()&&this.processQueue(),t.id}async processQueue(){if(this.isProcessing||!ve())return!1;this.isProcessing=!0;let e=!0;try{const t=this.operations.filter(r=>r.status==="pending");if(t.length===0)return!0;console.log(`Processing ${t.length} pending operations in sync queue`);for(const r of t){try{r.status="processing",this.saveToStorage(),await this.executeOperation(r),r.status="completed",console.log(`Operation ${r.id} completed successfully`)}catch(i){console.error(`Failed to process operation ${r.id}:`,i),r.retries=(r.retries||0)+1,r.retries>=ca?(r.status="failed",r.error=i instanceof Error?i.message:String(i),e=!1):r.status="pending"}this.saveToStorage()}return this.cleanup(),e}finally{this.isProcessing=!1}}async executeOperation(e){const{tableName:t,operation:r,data:i,conditions:n}=e;switch(r){case"insert":{const{error:o}=await _.from(t).insert(i);if(o)throw o;break}case"update":{if(!n)throw new Error("Update operation requires conditions");let o=_.from(t).update(i);Object.entries(n).forEach(([l,c])=>{c===null?o=o.is(l,null):Array.isArray(c)?o=o.in(l,c):o=o.eq(l,c)});const{error:a}=await o;if(a)throw a;break}case"delete":{if(!n)throw new Error("Delete operation requires conditions");let o=_.from(t).delete();Object.entries(n).forEach(([l,c])=>{c===null?o=o.is(l,null):Array.isArray(c)?o=o.in(l,c):o=o.eq(l,c)});const{error:a}=await o;if(a)throw a;break}default:throw new Error(`Unsupported operation type: ${r}`)}}cleanup(){const e=Date.now()-864e5;this.operations=this.operations.filter(t=>t.status!=="completed"||t.timestamp>e),this.saveToStorage()}getPendingOperations(){return this.operations.filter(e=>e.status==="pending")}getFailedOperations(){return this.operations.filter(e=>e.status==="failed")}getOperation(e){return this.operations.find(t=>t.id===e)}retryOperation(e){const t=this.operations.find(r=>r.id===e);if(!t)throw new Error(`Operation with ID ${e} not found`);if(t.status!=="failed")throw new Error(`Cannot retry operation with status ${t.status}`);return t.status="pending",t.retries=0,t.error=void 0,this.saveToStorage(),ve()&&this.processQueue(),t}clear(){this.operations=[],this.saveToStorage()}destroy(){this.stopAutoSync(),this.networkListenerRemover&&(this.networkListenerRemover(),this.networkListenerRemover=null)}}function ha(){return Math.random().toString(36).substr(2,9)}const Oe=new da;window.addEventListener("load",()=>{ve()&&Oe.processQueue()});window.addEventListener("unload",()=>{Oe.destroy()});const fa={class:"network-status"},ga={class:"status-icon"},pa={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},va={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ma={class:"status-text"},_a={key:0,class:"sync-info"},ya={class:"sync-count"},wa=pt({__name:"NetworkStatus",setup(s){const e=$(ve()),t=$(0),r=$(null),i=$(null),n=V(()=>e.value?"Online":"Offline"),o=()=>{t.value=Oe.getPendingOperations().length},a=()=>{e.value&&t.value>0&&(Oe.processQueue(),o())};return cr(()=>{r.value=ts(l=>{e.value=l,l&&t.value>0&&Oe.processQueue(),o()}),i.value=window.setInterval(()=>{o()},5e3),o()}),js(()=>{r.value&&r.value(),i.value&&clearInterval(i.value)}),(l,c)=>(C(),x("div",fa,[A("div",{class:st(["status-indicator",{online:e.value,offline:!e.value}])},[A("div",ga,[e.value?(C(),x("svg",pa,c[0]||(c[0]=[A("path",{d:"M5 12.55a11 11 0 0 1 14.08 0"},null,-1),A("path",{d:"M1.42 9a16 16 0 0 1 21.16 0"},null,-1),A("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"},null,-1),A("circle",{cx:"12",cy:"20",r:"1"},null,-1)]))):(C(),x("svg",va,c[1]||(c[1]=[Jt('<line x1="1" y1="1" x2="23" y2="23" data-v-2138683c></line><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55" data-v-2138683c></path><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39" data-v-2138683c></path><path d="M10.71 5.05A16 16 0 0 1 22.58 9" data-v-2138683c></path><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88" data-v-2138683c></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0" data-v-2138683c></path><circle cx="12" cy="20" r="1" data-v-2138683c></circle>',7)])))]),A("div",ma,me(n.value),1)],2),t.value>0?(C(),x("div",_a,[c[2]||(c[2]=Jt('<div class="sync-icon" data-v-2138683c><svg class="sync-spinner" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-2138683c><path d="M21 12a9 9 0 0 1-9 9" data-v-2138683c></path><path d="M3 12a9 9 0 0 1 9-9" data-v-2138683c></path><path d="M21 12a9 9 0 0 0-9 9" data-v-2138683c></path><path d="M3 12a9 9 0 0 0 9-9" data-v-2138683c></path></svg></div>',1)),A("div",ya,me(t.value)+" "+me(t.value===1?"change":"changes")+" pending sync",1),e.value&&t.value>0?(C(),x("button",{key:0,class:"sync-now-btn",onClick:a},"Sync now")):pe("",!0)])):pe("",!0)]))}}),ba=rs(wa,[["__scopeId","data-v-2138683c"]]),Sa={class:"main-content"},ka=pt({__name:"App",setup(s){const e=xs(),t=Ft(),r=St(),i=$(!0),{loadShiftData:n,isShiftActive:o}=t;async function a(l=0){try{return console.log(`App mounted - initializing application... (attempt ${l+1})`),await Jo(),await r.initialize(),await n(),await new Promise(c=>setTimeout(c,100)),o&&e.currentRoute.value.name==="home"&&(console.log("Active shift detected, navigating to tasks screen"),e.push({name:"tasks"})),console.log("Application initialization complete - shift active:",o),!0}catch(c){return console.error(`Error initializing application (attempt ${l+1}):`,c),l<2?(console.log("Retrying initialization in 500ms..."),await new Promise(u=>setTimeout(u,500)),a(l+1)):!1}finally{l===0&&(i.value=!1)}}return cr(async()=>{await a()}),window.addEventListener("online",()=>{console.log("App is back online, refreshing data..."),Go(),i.value||r.initialize().catch(l=>{console.error("Error reloading settings after coming online:",l)})}),$s(()=>o,(l,c)=>{!l&&c&&e.push({name:"home"})}),(l,c)=>{const u=Is("router-view");return C(),x(Cs,null,[Re(la,null,{"network-status":Qe(()=>[Re(ba)]),_:1}),A("main",Sa,[Re(u,null,{default:Qe(({Component:f})=>[Re(Rs,{name:"fade",mode:"out-in"},{default:Qe(()=>[(C(),Ls(Ds(f)))]),_:2},1024)]),_:1})])],64)}}}),Ea=[{path:"/",name:"home",component:()=>R(()=>import("./HomeView-yfuiFtYB.js"),__vite__mapDeps([0,1,2,3,4,5,6]))},{path:"/tasks",name:"tasks",component:()=>R(()=>import("./TasksView-B-Ge2RCQ.js"),__vite__mapDeps([7,1,2,3,8,9,10,11,4,5,12]))},{path:"/tasks/pending",name:"pendingTasks",component:()=>R(()=>import("./PendingTasksView-C5RbsTsh.js"),__vite__mapDeps([13,8,1,9,14]))},{path:"/tasks/completed",name:"completedTasks",component:()=>R(()=>import("./CompletedTasksView-FLnKflQE.js"),__vite__mapDeps([15,8,1,9,16]))},{path:"/tasks/form",name:"taskForm",component:()=>R(()=>import("./TaskFormView-RZHbZGq6.js"),__vite__mapDeps([17,1,2,3,18])),props:s=>({taskId:s.query.taskId})},{path:"/archive",name:"archive",component:()=>R(()=>import("./ArchiveView-TO0kh7Cn.js"),__vite__mapDeps([19,1,20]))},{path:"/archive/:shiftId",name:"shiftDetail",component:()=>R(()=>import("./ShiftDetailView-XqbI0rzn.js"),__vite__mapDeps([21,1,10,11,22])),props:!0},{path:"/settings",name:"settings",component:()=>R(()=>import("./SettingsView-dSrE3VrF.js"),__vite__mapDeps([23,2,1,3,24]))}],M=Us({history:Fs(),routes:Ea,scrollBehavior(){return{top:0}}}),Ta=Bs(),ne=Ns(ka);ne.use(Ta);ne.use(M);ne.provide("router",M);ne.provide("route",M.currentRoute);ne.provide("navigate",(s,e)=>{if(s==="home")M.push({name:"home"});else if(s==="tasks")M.push({name:"tasks"});else if(s==="pendingTasks")M.push({name:"pendingTasks"});else if(s==="completedTasks")M.push({name:"completedTasks"});else if(s==="taskForm"){const t=(e==null?void 0:e.taskId)||(typeof e=="object"?e.taskId:void 0);M.push({name:"taskForm",query:t?{taskId:t}:void 0})}else s==="archive"?M.push({name:"archive"}):s==="shiftDetail"?M.push({name:"shiftDetail",params:{shiftId:e==null?void 0:e.shiftId}}):s==="settings"&&M.push({name:"settings"})});ne.config.globalProperties.$appInitialized=!1;const Aa=async()=>{try{await St().initialize(),await Ft().loadShiftData(),console.log("App mounted - initializing application..."),ne.config.globalProperties.$appInitialized=!0}catch(s){console.error("Error initializing application:",s)}};Aa();window.addEventListener("shift-ended",()=>{M.push({name:"home"})});ne.mount("#app");export{rs as _,St as a,Ko as b,qa as c,Na as f,ja as g,Ft as u};
